OO(["com.mi.utils.time","com.mi.utils.Cookie","com.mi.widgets.sms","com.mi.passport.mibao","com.mi.utils.L11N","com.mi.utils.URL","com.mi.utils.Tip"],"com.mi.passport.portal.2014",function(y,p,l,E,v,m,F,n){window._tickRequests=[];function d(L,N){N=N||"0";var M=(+new Date)+"";var K="/pass/ajax/tick?_t="+M+"&biz="+L+"&step="+N;var I=_tickRequests.length;var J=_tickRequests[I]=new Image;J.onload=J.onerror=function(){J=_tickRequests[I]=null};J.src=K}function C(){location.reload(true)}function z(){location.reload(true)}function H(){var J=p.get("userId");var I=p.get("cUserId");if(J&&!isNaN(J)){if(J!==$(".na-num").text()){z();return false}return true}else{if(!!I){if(I!==JSP_VAR.cUserId){z();return false}return true}else{C();return false}}}var b="";function o(I){b=I;location.hash=I}function D(M){var L=location.search.substring(1);var O=L.split("&");var K=0,N,J,I="";for(;N=O[K++];){J=N.indexOf("=");if(N.substring(0,J)===M){I=N.substring(J+1);break}}return I}function f(I){if(I==="+86"){return"^1\\d{10}$"}else{return"^\\+?\\d{6,}$"}}function x(I){if(/^\d+$/.test(I)){return true}return false}function h(I){if(!/[\/<>\%]+/.test(I)){return true}return false}var r=["password","repassword","repassword2","passwordUsed"];function s(L,J,M,I){var P=".mod_tip_bd"||".bd";if(!M){M=""}else{M=""+M}var L=$(L);if(L.hasClass("quota_tip")){return}var O=MSG[J]||J;var N=L.parent().parent().next();if(L.parent().hasClass("areapicker_item")){N=L.closest(".login-location").find(".error-con")}if(O){if(M){var K=M.charAt(0);if(K==="5"){N.find("span").html(O+"("+M+")")}else{N.find("span").html(O)}}else{N.find("span").html(O)}if(!I){L.parent().addClass("error_bg")}N.removeClass("txt_tip");N.show()}else{if(M){N.find("span").html(M);if(!I){L.parent().addClass("error_bg")}N.show()}else{L.parent().removeClass("error_bg");if(L.data("error")===".error-password"){L.closest("dd").find(".labelbox").removeClass("error_bg");N.addClass("txt_tip");N.find("span").html(N.find("span").data("origin"))}else{N.hide()}}}}function G(L,J){var M=L.attr("name");var I=L.val();var K=L.attr("type");if($.inArray(M,r)===-1){I=$.trim(I)}if(K!=="file"){if(I===""&&!J){s(L,M+"_empty")}else{if(!e(M,I,L)){s(L,M+"_rule")}}}}function e(K,M,I){var J="";if(I.closest(".mod_tip_bd").length){J=I.closest(".mod_tip_bd").find(".tits em").text()}else{if(I.closest(".bd").length){J=I.closest(".bd").find(".cty-code").attr("_code")||""}}if(M&&M.length){if(K==="phone"||K==="eshopPhoneNumber"||K==="bindPhoneUsed"){var L=f(J);return RegExp(L).test(M)}else{if(K==="icode"){return/^\w{4,8}$/.test(M)}else{if(K==="email"||K==="bindEmailUsed"){return/^[\w.\-]+@(?:[A-Za-z0-9]+(?:-[A-Za-z0-9]+)*\.)+[A-Za-z]{2,6}$/.test(M)}else{if(K==="ticket"||K==="vkey"){return/^\d{4,8}$/.test(M)}else{if(K==="repassword"){return !(M.length<8||M.length>16||/^\d+$/.test(M)||/^[A-Za-z]+$/.test(M)||/^[^A-Za-z0-9]+$/.test(M))}else{if(K==="repassword2"){return M===$($(I).data("repeat")).filter("[name]").val()}else{if(K==="androidPhoneIMEI"){return x(M)}else{if(K==="identityName"||K==="identityNumber"){return h(M)}}}}}}}}}return true}function q(M,J){var I=$(M).find("input[name]");var L=$(M).find("select[name]");var K=0;$(I).each(function(){var O=$(this);var P=O.attr("name");var N=O.val();if($.inArray(P,r)===-1){N=$.trim(N)}if(!O.is(":hidden")&&!O.is(":disabled")&&O.attr("type")!=="file"){if(N===""&&!J){s(O,P+"_empty");K++;return false}else{if(!e(P,N,O)){s(O,P+"_rule");K++;return false}}}});if(K===0){$(L).each(function(){var O=$(this);var P=O.attr("name");var N=O.prop("selectedIndex");if(N<=0&&(P!=="province"&&P!=="city")){s(O,P+"_empty","",true);K++;return false}})}return K?false:true}$.parseJSONSafe=function(I){try{return $.parseJSON(I)}catch(J){return{code:5000000,result:5000000,description:"Not JSON"}}};$.fn.showError=function(I){if(!I){I=""}else{I=""+I}return this.each(function(K,M){var J=$(M);if(J.hasClass("quota_tip")){return}var N=J.attr("_text");if(N&&I){var L=I.charAt(0);if(L==="5"){J.text(N+"("+I+")").show()}else{J.text(N).show()}}else{if(I&&!N){J.text(I).show()}else{J.text(N).show()}}})};$.fn.hideError=function(){return this.each(function(J,K){var I=$(K);if(I.hasClass("quota_tip")){return}var L=I.attr("_text");if(L){I.text(L).hide()}else{I.hide()}})};$.fn.showPopup=function(){this.each(function(K,L){var J=$(L),I=J.closest(".popup_mask");if(I.length){I.show()}J.show();switch(L.id){case"popManageTokenStatus":case"popManageTokenKeys":J.positionPopup();default:}if(D("_service")){return}switch(L.id){case"popManageTokenStatus":case"popManageTokenHome":o("#service=setToken");break;case"popSwitchRegion":o("#service=switchRegion");break;case"popUpdatePassword":o("#service=setPassword");break;case"popEnterNewEmail":o("#service=bindEmail");break;case"popEnterNewPhone":o("#service=bindPhone");break;case"popSetMibao":case"popAnswerMibao":case"popFinishMibao":o("#service=setMibao");break;case"popSuicideWarning":o("#service=suicide");break;default:}});if($(".popup_mask:visible").length){$(document.body).css({"overflow-y":"hidden"})}else{}return this};$.fn.hidePopup=function(I){I=I||{};this.each(function(L,M){var K=$(M),J=K.closest(".popup_mask");if(J.length){J.hide()}K.hide();if(!I.dontAffectHash){switch(M.id){case"popUpdatePassword":case"popEnterNewEmail":case"popEnterNewPhone":case"popSetMibao":case"popAnswerMibao":case"popFinishMibao":case"popManageTokenStatus":case"popManageTokenHome":case"popSuicideWarning":case"popSuicidePrompt":case"popSuicideSuccess":case"popSuicideFailure":case"popSwitchRegion":if(location.hash){o("#")}break;default:}}});if($(".popup_mask:visible").length){$(document.body).css({"overflow-y":"hidden"})}return this};$.fn.positionPopup=function(){return this.each(function(K,L){var J=$(L);var I=$(window).height();var M=L.offsetHeight;if(M>I){J.css("top","0")}else{J.css("top",Math.round((I-M)/2)+"px")}})};$.fn.radioTab=function(){var Q=new Date();var P=Q.getFullYear();var O=Q.getMonth()+1;var L=Q.getDate();var R=function(ab){ab.__initedTab=true;var Y=$(ab);var S=Y.find(".md_list_con");var Z=Y.find(".retrieve-type-year");var X=Y.find(".retrieve-type-month");var T=Y.find(".retrieve-type-date");var aa="";var U="";var W={};W[28]="";for(var V=P;V>2010;V--){aa+="<p data-value='"+V+"'>"+V+"</p>"}$.each(["01","02","03","04","05","06","07","08","09","10","11","12"],function(ac,ad){U+="<p data-value='"+ad+"'>"+ad+"</p>"});$.each(["13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28"],function(ac,ad){W[28]+="<p data-value='"+ad+"'>"+ad+"</p>"});W[28]=U+W[28];W[29]=W[28]+"<p data-value='29'>29</p>";W[30]=W[29]+"<p data-value='30'>30</p>";W[31]=W[30]+"<p data-value='31'>31</p>";Z.html(aa);X.html(U);Y.find(".date-select").each(function(ad,ae){var af=$(ae).find(".date-select-val");var ac=$(ae).find(".date-select-options");af.click(function(){s($(this).closest("li[data-type]"));ac.toggle();return false});af.find(".timecon").data("value","");ac.delegate("p","click",function(ai){var ah=$(this).data("value");var ag=af.find(".timecon");if(!ag.data("origin")){ag.data("origin",ag.text())}ag.data("value",ah).text(ah);ac.hide();N(T,W);J();return false})});Y.find("textarea").bind("input change propertychange",function(){J()})};var M=this;var N=function(V,Y){var ac=M.filter(".now");var T=ac.find(".md_list_con");var ad=T.data("type");var X=T.find(".date-select-val .timecon");var ae=parseInt($(X[0]).data("value"),10);var U=parseInt($(X[1]).data("value"),10);var ab=parseInt($(X[2]).data("value"),10);if(X.length===3){if(ae&&U){var aa=new Date(new Date(ae,U)-1).getDate();V.html(Y[aa]);if(ab&&ab>aa){var af=$(X[2]).data("origin");af&&$(X[2]).text(af).data("value",af)}}else{var af=$(X[2]).data("origin");af&&$(X[2]).text(af).data("value",af)}}var W=$(T.find(".retrieve-type-month")).find("p");var S=$(T.find(".retrieve-type-date")).find("p");if(ae&&ae===P){$(W).each(function(ag,ai){var ah=parseInt($(ai).data("value"),10);if(ah<=O){$(ai).show()}else{$(ai).hide()}});$(S).each(function(ag,ai){var ah=parseInt($(ai).data("value"),10);if(U===O){if(ah<=L){$(ai).show()}else{$(ai).hide()}}});if(U>O){var af=$(X[1]).data("origin");af&&$(X[1]).text(af).data("value",af);var Z=$(X[2]).data("origin");Z&&$(X[2]).text(Z).data("value",Z)}if(ab&&ab>L&&U===O){var af=$(X[2]).data("origin");af&&$(X[2]).text(af).data("value",af)}}else{$(W).show()}};var K=function(){var W=M.filter(".now");var S=W.find(".md_list_con");var V=S.data("type");var X=W.data("type");var U="";if(V==="date"){var T=S.find(".date-select-val .timecon");U=""+$(T[0]).data("value")+"-"+$(T[1]).data("value")+(T[2]?("-"+$(T[2]).data("value")):"");if(X===3){if(U.split("-").join("").length<8){return false}}else{if(U.split("-").join("").length<6){return false}}}else{U=S.find("textarea").val()+"";if(U.length<10){return false}}return{retrieveType:X,retrieveTypeValue:U}};var I="";var J=function(){var S=K();if(S!==I){I=S;M.filter(".now").trigger("radioTabValueChange",S)}};this.each(function(S,T){$(T).click(function(){s($(this));M.removeClass("now");$(this).addClass("now");$(this).find(".date-select-options").hide();!this.__initedTab&&R(this);J()})});return this};$(function(){$(".err_tip, .txt_tip").each(function(J,K){var I=$(K);I.attr("_text",I.text())})});function w(I){if(I){if(I.code&&I.code!=3001){var J=$("#popVeriFailed");J.find(".identity-error").hide();if(I.status===403){J.find(".forbidden-error").show()}else{J.find(".ohter-error").show()}J.find(".err_code").text(I.code);J.showPopup()}}}var j=n.$class({constructor:function(){this.$passwordMgr=$("[_role=passwordMgr]");this.$emailMgr=$("[_role=emailMgr]");this.$phoneMgr=$("[_role=phoneMgr]");this.$mibaoMgr=$("[_role=mibaoMgr]");this.$tokenMgr=$("[_role=tokenMgr]")},syncService:function(){var J=m.parse(location.hash);var I=D("_service");var K=J.service||"";if(I){service=I}else{if(K){service=K}else{return}}switch(service){case"bindPhone":d("changePhone");$("#btnUpdatePhone").click();break;case"bindEmail":d("changeEmail");$("#btnUpdateEmail").click();break;case"setMibao":$("#btnSetMibao").click();break;case"setPassword":d("changePassword");$("#btnUpdatePassword").click();break;case"setToken":d("enableTwoStepLogin");$("#btnManageToken").click();break;case"suicide":d("delAccount");this.suicide();break;default:$("#popUpdatePassword, #popEnterNewEmail, #popEnterNewPhone, #popSetMibao, #popAnswerMibao, #popFinishMibao, #popManageTokenStatus, #popSuicideWarning, #popManageTokenHome, #popManageTokenStatus").hidePopup()}},render:function(){this.uiBind();this.syncService()},phoneImageBlurTimer:null,emailImageBlurTimer:null,showPhonePanel:function(){var O=$("#phonePanel");var N=$(".phone-panel-main").show();var M=$(".phone-panel-del").hide();var J=$(".phone-panel-del-success").hide();var K=O.find(".phone_panel_list_con");O.showPopup();if(!O.data("panel-inited")){var I=$(".phone-bind-adress").data("key");O.data("panel-inited",true);K.delegate(".phone_panel_list_el","click",function(Q){Q.stopPropagation();K.find(".phone_panel_list_el").removeClass("now");$(this).addClass("now");var P=$(".phone-panel-main-button").find('a[data-action="update"]');if($(this).find(".phone-panel-number").data("key")!==I){P.hide()}else{P.show()}});N.find("a[data-action]").bind("click",n.proxy(function(U){U.stopPropagation();var T=$(U.target).data("action");var S=K.find(".now .phone-panel-number");var Q=S.data("phone");var R=S.data("key");if(!Q||!R){return}if(T==="update"){if(I!==S.data("key")){return false}else{d("changePhone");MiAccountVerification({url:"/pass/auth/security/updatePhone?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(X){this.enterNewPhone(X)},this,{action:T,phone:Q,key:R}),fail:function(X){w(X)},beforeModal:function(){O.hidePopup({dontAffectHash:true})}})}}else{N.hide();M.show();M.find(".err_tip").hide();M.find("input[name=delphone]").val("");M.find("input[name=delphone]").parent().removeClass("error_bg");var W=M.find(".phone-panel-del-title");var V=$(".del-ph-num");W.html(W.data("title-tpl").replace("{phone}",Q));V.html(Q);var P=Q.split(/\*+/);if(P.length===2){M.find(".phone-blank-prefix").text(P[0]+"");M.find(".phone-blank-suffix").text(P[1]+"")}}return false},this));M.find("input[name=delphone]").bind("focus",function(){M.find(".err_tip").hide()});M.find("a[data-action]").bind("click",n.proxy(function(R){R.stopPropagation();var Q=$(R.target).data("action");if(Q==="cancel"){M.hide();N.show();return}var P=[$.trim(M.find(".phone-blank-prefix").text()),$.trim(M.find("input[name=delphone]").val()),$.trim(M.find(".phone-blank-suffix").text())].join("");var S=M.find(".err_tip");$.ajax({type:"post",url:"/pass/auth/security/deletePhone",dataType:"text",data:{passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",userId:$(".na-num").text(),phone:P},success:function(U){U=U.replace("&&&START&&&","");U=$.parseJSONSafe(U);var T=+U.result;if(T===0){M.hide();J.show()}else{if(T===1200254||T===1200255){S.show().find(".del-error").html(v.getResource("jsp_ph_delete_error"))}else{if(T===5200253||T===5200257){S.show().find(".del-error").html(v.getResource("jsp_error")+T)}}}},fail:function(){S.show().find(".del-error").html(v.getResource("jsp_error"))},error:function(){S.show().find(".del-error").html(v.getResource("jsp_error"))}})},this));J.find("a[data-action]").bind("click",function(P){P.stopPropagation();J.hide();location.reload()})}var L=[];$.each(userPhoneList,function(P,Q){L.push("<li class='phone_panel_list_el'>  <i class='acctip_icon acctip_icon_8'></i>  <span data-phone='"+Q.address+"' class='phone-panel-number' data-key='"+Q.key+"'>"+Q.address+"</span></li>")});K.html(L.join(""))},suicide:function(){var I=$("#popSuicideWarning");I.find(".twostep_trustinfo").removeClass("now");I.find(".err_tip").hideError();I.showPopup();$.ajax({type:"GET",url:"/pass/auth/security/getAccountStatus",data:{userId:$(".na-num").text()},dataType:"text",success:function(M){M=M.replace("&&&START&&&","");M=$.parseJSONSafe(M);var K=+M.result;if(K===0){var J=+M.info.leftTimes;if(J<=1){I.find(".warn-text").show()}}else{if(K===5200600){var L=M.info&&M.info.sids;$.each((L||[]),function(N,O){I.find(".del-account-deny-"+(O+"").split(".").join("")).show()});I.find(".del-account-allow").hide();I.find(".del-account-deny").show();I.find(".del-account-deny .btn_back").css({border:"1px solid #ff6f3d",color:"#FFF",background:"#ff6f3d"})}else{I.find(".sys_err").showError(K)}}}})},uiBind:function(){$("#popSuicideWarning .twostep_trustinfo").click(function(ab){var ac=$("#popSuicideWarning");var ad=$(ab.currentTarget);ad.toggleClass("now");if(ac.find(".sys_err:visible").length){ac.find(".btn_commom").addClass("disabled")}else{if(ad.hasClass("now")){ac.find(".btn_commom").removeClass("disabled")}else{ac.find(".btn_commom").addClass("disabled")}}});$("#popSuicideWarning .btn_commom").click(n.proxy(function(ae){ae.preventDefault();var ag=$(ae.currentTarget);var af=$("#popSuicidePrompt");if(ag.hasClass("disabled")){return}$("#popSuicideWarning").hidePopup({dontAffectHash:true});var ad=false;var ac="";var ab="";MiAccountVerification({url:"/pass/auth/security/del?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){ad=true;$.ajax({type:"GET",url:"/pass/auth/security/getAllLoginDevices",data:{userId:$(".na-num").text()},dataType:"text",success:function(aj){aj=aj.replace("&&&START&&&","");aj=$.parseJSONSafe(aj);var ah=+aj.result;if(ah===0){ac=aj.info.device;if(ac.length){$(".del-devices-panel").show();for(var ai=0;ai<ac.length;ai++){ab+="<li>"+ac[ai]+"</li>"}$(".online-devices").append(ab)}}else{af.find(".sys_err").showError(ah)}$("#popSuicideWarning").hidePopup({dontAffectHash:true});$("#popSuicidePrompt").showPopup()}})},this),fail:function(ah){if(ad){return}$("#popSuicideWarning").showPopup();w(ah)}})},this));$("#popSuicidePrompt .btn_commom").click(function(ab){ab.preventDefault();var ac=$("#popSuicidePrompt");$.ajax({type:"POST",url:"/pass/auth/security/del",data:{passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",userId:$(".na-num").text()},dataType:"text",success:function(ae){ae=ae.replace("&&&START&&&","");ae=$.parseJSONSafe(ae);var ad=+ae.result;if(ad===0){$("#popSuicidePrompt").hidePopup({dontAffectHash:true});$("#popSuicideSuccess").showPopup();var af=new y.Countdown({duration:10000,onProgress:function(ag){$("#popSuicideSuccess .wapbox p span").text(Math.round(ag.timeLeft/1000))},onComplete:function(){location.href="/"}});af.start()}else{switch(ad){case 1200603:ac.find(".del_fail").showError(ad);case 5200604:case 5200605:case 5200606:case 5200607:ac.find(".sys_err").showError(ad);default:}}}})});$("#popSuicideWarning .btn_back, #popSuicidePrompt .btn_back, #popSuicideSuccess .btn_back, #popSuicideFailure .btn_back").click(function(ab){ab.preventDefault();$(ab.target).closest(".mod_acc_tip").hidePopup()});$(document.body).delegate(".mod_acc_tip .btn_mod_close, .mod_acc_tip .btn_close_popup","click",function(ab){ab.preventDefault();var ac=$(ab.target).closest(".mod_acc_tip"),ad=ac.attr("id");if(!!W("_callback")){location.href=decodeURIComponent(W("_callback"));return false}switch(ad){case"popManageTokenSetMobile":$("#popManageTokenStatus").showPopup().find(".err_tip").hide();ac.hidePopup();break;case"popManageTokenKeys":$("#popManageTokenStatus").showPopup().find(".err_tip").hide();ac.hidePopup();break;case"popManageTokenDisableFinish":location.href="/";break;case"popManageTokenFinish":location.href="/";break;case"popEnterNewPhone":if(ac.find("dl.success:visible").length){location.href="/"}else{ac.hidePopup()}n.proxy(this.cancelUpdatePhone,this);return false;break;case"popEnterNewEmail":if(ac.find("dl.success:visible").length){location.href="/"}else{ac.hidePopup()}break;case"popFinishMibao":location.href="/";break;default:ac.hidePopup()}});$("#popManageTokenTrustDevice .token_chk_area").click(function(ad,ac){ad.preventDefault();var ab=$("#popManageTokenTrustDevice .icon_token_chk");if(JSP_VAR.deviceType==="mobile"){if(ab.closest("#popManageTokenTrustDevice").length){ad.stopPropagation()}}if(ab.hasClass("icon_false")){ab.removeClass("icon_false").addClass("icon_true")}else{ab.removeClass("icon_true").addClass("icon_false")}});$(".click-row .font-img-item").click(function(ac){ac.preventDefault();ac.stopPropagation();if(JSP_VAR.deviceType!=="mobile"){return}var ab=$(ac.currentTarget).parent().find(".ada-btn-area");var ad=ab.children().length;if(ad>1){ab.toggle()}else{ab.click()}});$("#btnUpdatePassword").click(n.proxy(function(ab){ab.stopPropagation();ab.preventDefault();if(!H()){return}d("changePassword");MiAccountVerification({url:"/pass/auth/security/changePassword?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){this.resetUpdatePasswordForm();this.editPassword()},this),fail:function(ac){w(ac)}})},this));$(".pwd-eye").on("click",function(){$(this).toggleClass("chk");var ab=$(this).parents(".pwd-visiable").siblings(".visiablePwd");var ac=$(this).parents(".pwd-visiable").siblings(".hidePwd");ab.toggle();ac.toggle();return false});$(".pwd_panel input").on("change",function(){$(this).siblings("input").val($(this).val())});$(".chkcode_img").click(function(ad){ad.stopPropagation();var ac=$(this);var ab=ac.attr("src")||"/pass/getCode?icodeType=antispam";ab=ab.replace(/_t\=\d*/g,"_t="+(+new Date));ac.attr("src",ab);$(this).parent().find("[name$='code']").val("");return false});var U=n.proxy(function(ac){ac.stopImmediatePropagation();var ab=ac.target;$(ab.parentNode).removeClass("error_bg");$("#popUpdatePassword .capt_box .err_tip").hideError()},this);$("#popUpdatePassword .btnCancel").click(n.proxy(function(ab){ab.preventDefault();$("#popUpdatePassword").hidePopup()},this));$("#popUpdatePassword .btnOK").click(n.proxy(function(ab){ab.preventDefault();this.onUpdatePassword(ab)},this));if(userPhoneList.length){$(".btnBindMobile").text(v.getResource("jsp_add"))}if(userPhoneList.length>1){var X=$(".phone-list-sum");if(X.length>0&&X.data("title")){X.html(X.data("title").replace("{phsum}",userPhoneList.length))}X.show()}$("#btnUpdatePhone").click(n.proxy(function(af){af.stopPropagation();af.preventDefault();if(!H()){return}var ae=af.target;var ad="add";var ac="/pass/auth/security/addPhone";var ab=userPhoneList[0]||{};if($(ae).parent().find(".n-btn").data("mode")==="update"){ad="update";ac="/pass/auth/security/updatePhone";if(userPhoneList.length>1){this.showPhonePanel();return}}d("changePhone");MiAccountVerification({url:ac+"?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(ag){this.enterNewPhone(ag)},this,{action:ad,phone:ab.address,key:ab.key}),fail:function(ag){w(ag)}})},this));var R=$("input[name]");R.bind("focus",function(){s($(this))});R.bind("blur",function(){G($(this))});$("#popEnterNewPhone .binding .btn_commom").click(n.proxy(this.onEnterNewPhone,this));var L=$(".bind-info-panel");var O=$("#popEnterNewPhone .binding");L.delegate("a[data-action]","click",n.proxy(function(ad){ad.stopPropagation();var ac=$(ad.target).data("action");var ab=$(ad.target).data("type");if(ac==="ok"){this.checkNewPhone()}else{if(ac==="back"){L.hide();O.show()}}},this));$("#popEnterNewPhone .binding .set_qst_tit").click(function(ab){$("#popEnterNewPhone .binding .country-container-panel").toggle();ab.stopPropagation();ab.preventDefault()});var N=$(".country-container-panel");N.each(function(ac,ad){var ab=$("<div>").addClass("country-container");ab.html(RegionsCode.getAll({usual:"常用"},true));$(ad).append(ab)});$(".country-container-panel .country-container").delegate(".record","click",function(ag){var ab=$(ag.target),af=ab.closest(".binding").find(".set_qst_tit"),ah=af.find("span"),ac=af.find("em");var ae=ab.closest(".record");var ad=ae.find(".record-country");ah.text(ad.text());ac.text(ad.data("code"));ac.attr("_code",ad.data("code"));ab.closest(".country-container-panel").hide();ag.preventDefault()});$(document.body).click(function(ab){$(".country-container-panel").hide()});$(".country-container-panel .btn-cancel").bind("click",function(ab){ab.stopPropagation();$(this).closest(".country-container-panel").hide()});N.bind("click",function(ab){ab.stopPropagation()});if(JSP_VAR.deviceType==="mobile"){var I=$(".navbar");I.delegate("a","click",function(ah){var ae=$(this);var ac=ae.closest(".country-container").find(".country-code");var ab=ac.scrollTop();var af=ae.attr("to");var ad=ac.find(".countrycode-container-"+af);while(ad.length===0){ae=ae.prev();ad=ac.find(".countrycode-container-"+ae.attr("to"))}var ag=ad.offset().top;ac.scrollTop(ab+ag);return false})}$("#popEnterNewPhone .verify .btn_commom").click(n.proxy(this.onVerifyNewPhone,this));$("#popEnterNewPhone .verify .btn_back").click(n.proxy(this.cancelUpdatePhone,this));function W(ab){var ad="",ac=false;if(location.search.length===0){return ad}if(location.search.indexOf("?")==0&&location.search.indexOf("=")>1){arrSource=location.search.substring(1,location.search.length).split("&");i=0;while(i<arrSource.length&&!ac){if(arrSource[i].indexOf("=")>0){if(arrSource[i].split("=")[0].toLowerCase()==ab.toLowerCase()){ad=arrSource[i].split("=")[1];ac=true}}i++}}return ad}var V=null;$("#popEnterNewPhone .verify .resend").click(function(){clearTimeout(V)});$("#popEnterNewPhone .success .btn_commom").click(function(ab){location.href="/";return false});var S=l.Sender;if(this.updatePhoneSMSSender){this.updatePhoneSMSSender.stop()}var M=this.updatePhoneSMSSender=new S({smsFailureMsgBox:".sms_custom",maxQuotaToShow:2,timeStep:60*1000,type:150007,onResend:false,userBox:$('<input type="text">').val($(".na-num").text()),phoneBox:"#popEnterNewPhone .binding .full_new_phone",icodeCallback:function(ad,ah){var ag=v.getResource("jsp_regst_img_code_incorrect");var ae=$("#popEnterNewPhone");var af=ae.find(".binding");var ac=ae.find(".bind-info-panel");var ab=ae.find(".verify");af.find(".chkcode_img").click();af.find(".capt_box").val("");if(!this.onResend){ac.hide();af.show()}if(ad===0){$(ae.find(".tab_opt span").removeClass("now")[1]).addClass("now");$(ae.find(".tabline i").removeClass("now")[1]).addClass("now");af.hide();ab.show()}else{if(ad===1200201){s(af.find(".capt_box"),"icode_rule")}else{if(ad===1200258){s(af.find(".new_phone"),"phone_rule")}else{if(ad===1200237){s(af.find(".new_phone"),"phoneUnqualCurrent")}else{if(ad===1200260){s(af.find(".new_phone"),"phBindToOther")}else{if(ad===1200235){s(af.find(".new_phone"),"reachMax")}else{if(ad===1200236){s(af.find(".capt_box"),"bad_param",ad,true)}else{if(ad===1200263){ab.hide();af.show();s(af.find(".capt_box"),"icode_rule")}else{if(ad===1200264){s($captchaPanel.find(".capt_box"),"icode_rule")}else{s(af.find(".capt_box"),"error_system",ad,true)}}}}}}}}}},getCaptchaPostData:function(ac){var ab=$("#popEnterNewPhone .new_phone").val();var ae=$("#popEnterNewPhone .set_qst_tit em").attr("_code")||"";var af=$("#popEnterNewPhone .binding .capt_box").val();if(ae==="+86"){ae=""}ab=ae+ab;var ad={userId:$(".na-num").text(),passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",phone:ab};return ad},phoneTipLabel:"",duplicatePhoneHTML:"",sendButton:"#popEnterNewPhone .verify .resend",captchaBox:"#popEnterNewPhone .verify .phone_capt","403Label":".fbdn_tip",quotaTextLabel:"#quotaTextLabel",quotaLabel:"#quotaLabel",captchaURL:"/pass/auth/security/sendBindPhoneTicket",quotaURL:"/pass/sms/quota",captchaVerifyLabel:"",captchaVerifyURL:"",checkBindingURL:"",quotaCache:{},smsDisabled:false});M.render();$("#popEnterNewPhone .binding .btn_commom").click(function(ab){ab.preventDefault()});$("#btnUpdateEmail").click(n.proxy(function(ab){ab.stopPropagation();ab.preventDefault();if(!H()){return}d("changeEmail");MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){this.enterNewEmail()},this),fail:function(ac){w(ac)}})},this));$("#popEnterNewEmail .binding .new_email").on("focus click",function(ab){$("#popEnterNewEmail .binding .err_tip:not(.empty_capt):not(.wng_capt)").hideError();$("#popEnterNewEmail .binding .new_email").parent().removeClass("error_bg")}).blur(n.proxy(function(ae){var ab=$("#popEnterNewEmail");var ad=ab.find(".binding");var ac=$.trim(ae.target.value);if(!ac){ad.find(".err_tip:not(.empty_capt):not(.wng_capt)").hideError();ad.find(".empty_email").showError();$(ae.target).parent().addClass("error_bg")}},this));$("#popEnterNewEmail .binding .capt_box").on("focus click",n.proxy(function(ad){clearTimeout(this.emailImageBlurTimer);var ab=$("#popEnterNewEmail");var ac=ab.find(".binding");ac.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();ac.find(".capt_box").parent().removeClass("error_bg")},this)).blur(n.proxy(function(ad){var ab=$("#popEnterNewEmail");var ac=ab.find(".binding");if(!$.trim(ad.target.value)){this.emailImageBlurTimer=setTimeout(function(){ac.find(".err_tip.empty_capt, .err_tip.wng_capt").hideError();ac.find(".empty_capt").showError();ac.find(".capt_box").parent().addClass("error_bg")},200)}},this));$("#popEnterNewEmail .binding .btn_commom").click(n.proxy(this.onEnterNewEmail,this));var P=$("#popEnterNewEmail .binding .select-edm");P.click(n.proxy(function(ab){if(P.hasClass("now")){P.removeClass("now")}else{P.addClass("now")}},this)).trigger("click");$("#popEnterNewEmail .verify .resend").click(n.proxy(this.onResendNewEmail,this));$("#popEnterNewEmail .verify .capt_box").on("focus click",n.proxy(function(ad){clearTimeout(this.emailCaptBlurTimer);var ac=$("#popEnterNewEmail");var ab=ac.find(".verify");ab.find(".err_tip").hideError();$("#popEnterNewEmail .verify .capt_box").parent().removeClass("error_bg")},this)).blur(n.proxy(function(ad){var ac=$("#popEnterNewEmail");var ab=ac.find(".verify");if(!$.trim(ad.target.value)){this.emailCaptBlurTimer=setTimeout(function(){ab.find(".empty_capt").showError();ab.find(".capt_box").parent().addClass("error_bg")},200)}},this));$("#popEnterNewEmail .verify .btn_back").click(n.proxy(this.cancelUpdateEmail,this));$("#popEnterNewEmail .verify .btn_commom").click(n.proxy(this.onVerifyNewEmail,this));$("#popEnterNewEmail .success .btn_commom").click(function(ac){ac.preventDefault();var ab=$("#popEnterNewEmail");location.href="/"});var Y=false;$("#btnSetMibao").click(n.proxy(function(ab){ab.stopPropagation();ab.preventDefault();if(!H()){return}d("changeMibao");MiAccountVerification({url:"/pass/auth/security/setSafeQuestions?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){if(!Y){if(K){Z.render();Y=true;$("#popSetMibao form").bind("submit",J)}else{if(!H()){return}$.ajax({type:"GET",url:"/pass/auth/security/verifyQuestions",dataType:"text",data:{userId:$(".na-num").text(),_:+new Date},error:C,success:function(ac){ac=ac.replace("&&&START&&&","");ac=$.parseJSONSafe(ac);if(ac.result===0){window.mibaoData=window.pageData=ac.info}Z.render();Y=true;$("#popSetMibao form").bind("submit",J)}})}}this.setMibao()},this),fail:function(ac){w(ac)}})},this));var Q=$("#frmSetQuestions");var K=window.mibaoData||window.pageData;var Z;Z=this.setMibaoForm=new E.QuestionForm({form:Q,ajax:true});var J=n.proxy(function(ad){var ae=$("#popAnswerMibao");var ac=$("#popSetMibao select.iselect");var ab=ae.find(".set_mibao li p");ab.each(function(ag,ah){var af=$(ah);af.text(ac[ag].value)});$("#popSetMibao").hidePopup();this.answerMibao()},this);$("#popAnswerMibao .input_bg input").bind("focus",function(ab){$(ab.target).closest("li").find(".error-mes").hide()});$("#popAnswerMibao .btn_back").click(function(ab){ab.preventDefault();$("#popAnswerMibao").hidePopup();$("#popSetMibao").showPopup();$("#popAnswerMibao .input_bg input").val("");return false});$("#popAnswerMibao .btn_commom").click(function(ad){ad.preventDefault();var ab=$("#popAnswerMibao .form-error-mes");ab.hide();var ac=false;$("#popAnswerMibao .input_bg input").each(function(ag,ah){var af=$(ah);var ae=af.closest("li").find(".error-mes");var ai=af.val();if(!ai){ae.text(v.getResource("answer_empty")).show();ac=true}else{ae.text("").hide()}});if(ac){return}if(!H()){return}$.ajax({url:"/pass/auth/security/setSafeQuestions",type:"POST",data:{userId:$(".na-num").text(),passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",questions:$("#popSetMibao .form-data").val(),verifiedQuestions:(function(){var ae=[];$("#popAnswerMibao .input_bg input").each(n.proxy(function(ag,ah){var af=$(ah);$question=af.parent().parent().find("p");ae.push('{"q":"'+E.QuestionForm.addSlashes($question.html())+'","a":"'+E.QuestionForm.addSlashes(af.val())+'"}')},this));return"["+ae.join(",")+"]"})()},dataType:"text",error:C,success:function(ae){ae=ae.replace("&&&START&&&","");ae=$.parseJSONSafe(ae);if(ae.result===0){ab.hide();$("#popAnswerMibao").hidePopup();$("#popFinishMibao").showPopup();d("changeMibao","end")}else{switch(ae.result){case 1200305:ab.text(v.getResource("wrong_answer")).show();break;case 5200306:case 5200307:case 5200308:ab.text(v.getResource("jsp_2014_tip23")+"("+ae.result+")").show();break;default:}}}});return false});$("#popFinishMibao .btn_commom").click(function(ab){ab.preventDefault();location.href="/"});$("#btnManageToken").click(n.proxy(function(ab){ab.stopPropagation();ab.preventDefault();if(!H()){return}d("enableTwoStepLogin");this.manageToken()},this));$(document.body).delegate("a[_href]","click",n.proxy(function(af){af.preventDefault();var ae=$(af.target);var ah=$(ae.attr("_href"));var ad=ae.attr("_target")||"self";var ag=ae.parents(".mod_acc_tip",true);var ac=ag.attr("id");var ai=ah.attr("id");function ab(){ah.find(".disten30x76 img").removeAttr("src").removeAttr("_secret").removeAttr("_reset");ah.find("input[type=text]").not(".pld").val("");ah.find(".err_tip").hideError();ah.find(".input_bg").removeClass("error_bg");$.placehold.removepld(ah);$.placehold.init(ah);if(!H()){return}$.ajax({type:"get",url:"/pass/auth/security/genEnableSecret",data:{userId:$(".na-num").text(),reset:$("#btnManageToken a").attr("__href").indexOf("status")>-1},dataType:"text",error:C,success:function(aj){aj=aj.replace("&&&START&&&","");aj=$.parseJSONSafe(aj);if(aj.result===0){ah.find(".disten30x76 img").attr("src",aj.info.QRCodeUrl).attr("_secret",aj.info.secret).removeAttr("_reset");if(ag.attr("id")==="popManageTokenStatus"){ah.find(".disten30x76 img").attr("_reset",true)}ah.find(".err_tip").hideError();if(ad!=="_blank"){ag.hidePopup({dontAffectHash:true})}ah.showPopup()}else{ag.find(".sys_err").showError(aj.result)}}})}switch(ai){case"popManageTokenDownload":if($("#btnManageToken a").attr("__href").indexOf("status")>-1){$("#popManageTokenDownload .tip_btns").addClass("token_enabled")}else{$("#popManageTokenDownload .tip_btns").removeClass("token_enabled")}if(ad!=="_blank"){ag.hidePopup({dontAffectHash:true})}ah.showPopup();break;case"popManageTokenSetMobile":if(!H()){return}MiAccountVerification({url:"/pass/auth/security/setBackupPhone?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){if(ad!=="_blank"){ag.hidePopup()}$.placehold.removepld(ah);$.placehold.init(ah);ah.hideError().showPopup();ah.find(".error_bg").removeClass("error_bg");ah.find(".err_tip").hideError()},this),fail:function(aj){w(aj)}});break;case"popManageTokenActivate":if(ac==="popManageTokenStatus"){if(!H()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){ab()},this),fail:function(aj){w(aj)}})}else{ab()}break;case"popManageTokenKeys":ah.find(".mi_code span").remove();if(!H()){return}$.ajax({url:"/pass/auth/security/backupOtp",dataType:"text",type:"GET",data:{userId:$(".na-num").text(),_:+new Date},error:C,success:function(al){al=al.replace("&&&START&&&","");al=$.parseJSONSafe(al);if(al.result===0){var ak=al.info.codes;var aj=ah.find(".mi_code");$.each(ak,function(am,an){if($.trim(an)){aj.append("<span>"+an+"&nbsp;&nbsp;&nbsp;&nbsp;</span>")}else{aj.append("<span _used>"+v.getResource("jsp_2014_token_used")+"</span>")}});if(al.info.email){ah.find(".sendEmail").attr("href","mailto:"+al.info.email)}if(ad!=="_blank"){ag.hidePopup()}ah.showPopup()}}});break;case"popEnterNewEmail":if(!H()){return}MiAccountVerification({url:"/pass/auth/security/bindSafeAddress?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){if(ad!=="_blank"){ag.hidePopup()}this.enterNewEmail()},this),fail:function(aj){w(aj)}});break;case"popEnterNewPhone":if(!H()){return}MiAccountVerification({url:"/pass/auth/security/addPhone?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){if(ad!=="_blank"){ag.hidePopup()}this.enterNewPhone()},this),fail:function(aj){w(aj)}});break;case"popManageTokenDownAct":if($("#btnUpdateEmail a").attr("__href").indexOf("replace=true")===-1){if(ad!=="_blank"){ag.hidePopup()}$("#popManageTokenBindEmail").showPopup();return}if(!userPhoneList.length){if(ad!=="_blank"){ag.hidePopup()}$("#popManageTokenBindPhone").showPopup();return}if(!H()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,beforeModal:function(){if(ad!=="_blank"){ag.hidePopup()}},success:n.proxy(function(){ah.find(".err_tip").hideError();ah.showPopup()},this),fail:function(aj){w(aj)}});break;default:ah.find(".err_tip").hideError();if(ad!=="_blank"){ag.hidePopup()}ah.showPopup()}},this));$("#popManageTokenDownload .newtab a").click(function(ad){ad.preventDefault();$("#popManageTokenDownload .newtab a").removeClass("now");var ac=$(ad.target);ac.addClass("now");var ab=ac.index();$($("#popManageTokenDownload .tabcon").hide()[ab]).show()});$("#popManageTokenActivate input[type=text]").on("focus click",function(ab){$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").removeClass("error_bg")}).blur(function(ab){if(!$.trim(ab.target.value)){$("#popManageTokenActivate .empty_capt").showError();$("#popManageTokenActivate .input_bg").addClass("error_bg")}});$("#popManageTokenActivate .btn_commom").click(function(ac){ac.preventDefault();$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").removeClass("error_bg");var ab=$.trim($("#popManageTokenActivate input[type=text]").val());if(!ab){$("#popManageTokenActivate .empty_capt").showError();$("#popManageTokenActivate .input_bg").addClass("error_bg");return}if(!H()){return}$.ajax({dataType:"text",url:"/pass/auth/security/checkCode",type:"POST",data:{passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",userId:$(".na-num").text(),secret:$("#popManageTokenActivate .disten30x76 img").attr("_secret"),code:ab},error:C,success:function(ad){ad=ad.replace("&&&START&&&","");ad=$.parseJSONSafe(ad);if(ad.result===0){if(!H()){return}MiAccountVerification({url:"/pass/auth/security/enableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:function(){$("#popManageTokenActivate").hidePopup();$("#popManageTokenTrustDevice .mod_trust i").addClass("icon_true");$("#popManageTokenTrustDevice").showPopup()},fail:function(ae){w(ae)}})}else{$("#popManageTokenActivate .err_tip").hideError();$("#popManageTokenActivate .input_bg").addClass("error_bg");switch(ad.result){case 1200413:case 1200414:$("#popManageTokenActivate .wng_capt").showError(ad.result);break;case 5200415:case 5000000:$("#popManageTokenActivate .sys_err").showError(ad.result);break;default:}}}})});$("#popManageTokenTrustDevice .btn_commom").click(function(ab){ab.preventDefault();if(!H()){return}$.ajax({url:"/pass/auth/security/enableTwoStepLogin",type:"post",dataType:"text",data:{passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",userId:$(".na-num").text(),secret:$("#popManageTokenActivate .disten30x76 img").attr("_secret"),reset:!!$("#popManageTokenActivate .disten30x76 img").attr("_reset"),isTrustEnable:!!$("#popManageTokenTrustDevice .mod_trust .icon_true").length,code:$("#popManageTokenActivate input[type=text]").val()},error:C,success:function(ac){ac=ac.replace("&&&START&&&","");ac=$.parseJSONSafe(ac);if(ac.result===0){$("#popManageTokenTrustDevice").hidePopup();var ad=new y.Countdown({duration:10000,onProgress:function(ae){$("#popManageTokenFinish .logoutCountdown").text(Math.round(ae.timeLeft/1000))},onComplete:function(){location.href="/"}});ad.start();$("#popManageTokenFinish .err_tip").hideError();$("#popManageTokenFinish").showPopup();d("enableTwoStepLogin","end")}else{switch(ac.result){case 5200430:$("#popManageTokenTrustDevice .wng_capt").showError(ac.result);break;default:$("#popManageTokenTrustDevice .sys_err").showError(ac.result)}}}})});$("#popManageTokenStatus .tip_btns .btn_disable_token").click(function(ab){ab.preventDefault();$("#popManageTokenStatus").hidePopup();if(!H()){return}MiAccountVerification({url:"/pass/auth/security/disableTwoStepLogin?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){$("#popManageTokenStatus .sys_err").hideError();if(!H()){return}$.ajax({url:"/pass/auth/security/disableTwoStepLogin",type:"POST",dataType:"text",data:{passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",userId:$(".na-num").text()},error:C,success:function(ac){ac=ac.replace("&&&START&&&","");ac=$.parseJSONSafe(ac);$("#popManageTokenStatus").showPopup();if(ac.result===0){$("#popManageTokenStatus").hidePopup();$("#popManageTokenDisableFinish").showPopup()}else{switch(ac.result){case 5200433:case 5200434:case 5200456:case 5200457:case 5200458:case 5000000:$("#popManageTokenStatus .sys_err").showError(ac.result);break;default:}}}})},this),fail:function(ac){$("#popManageTokenStatus").showPopup();w(ac)}})});$("#popManageTokenKeys #refresh_code").click(function(ac){ac.preventDefault();var ab=$("#popManageTokenKeys .mi_code");if(!H()){return}$.ajax({type:"POST",url:"/pass/auth/security/refreshBackupOtp",dataType:"text",data:{passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",userId:$(".na-num").text()},error:C,success:function(ae){ae=ae.replace("&&&START&&&","");ae=$.parseJSONSafe(ae);if(ae.result===0){ab.find("span").remove();var ad=ae.info.codes;$.each(ad,function(af,ag){if($.trim(ag)){ab.append("<span>"+ag+"&nbsp;&nbsp;&nbsp;&nbsp;</span>")}else{ab.append("<span _used>"+v.getResource("jsp_2014_token_used")+"</span>")}})}}})});$("#popManageTokenSetMobile .set_qst_tit").click(function(ab){$("#popManageTokenSetMobile .country-container-panel").toggle();ab.stopPropagation();ab.preventDefault()});$("#popManageTokenSetMobile .backupPhoneInput").on("focus click",function(ab){$("#popManageTokenSetMobile .err_tip").hideError();$("#popManageTokenSetMobile .input_bg").removeClass("error_bg")});$("#popManageTokenSetMobile .btn_commom").click(n.proxy(function(ae){ae.preventDefault();var af=$("#popManageTokenSetMobile"),ag=af.find(".backupPhoneInput");var ab=ag.val();if(!ab){af.find(".empty_phone").showError();$("#popManageTokenSetMobile .input_bg").addClass("error_bg");return}if(!/^\d+$/.test(ab)){af.find(".wng_fmt").showError();$("#popManageTokenSetMobile .input_bg").addClass("error_bg");return}var ad=$.trim(af.find(".c_b em").text());if(ad==="+86"){ad=""}var ac=ad+ab;if(!H()){return}$.ajax({type:"POST",dataType:"text",url:"/pass/auth/security/setBackupPhone",data:{passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",userId:$(".na-num").text(),phone:ac,replace:$("#popManageTokenStatus li:first-child dd").hasClass(".has_fb_mobile")},error:C,success:n.proxy(function(ah){ah=ah.replace("&&&START&&&","");ah=$.parseJSONSafe(ah);af.find(".err_tip").hideError();af.find(".backupPhoneInput").val("");if(ah.result===0){$("#popManageTokenStatus li:first-child dd .fb_mobile span").text(ac);$("#popManageTokenStatus li:first-child dd").addClass("has_fb_mobile");af.hideError();af.hidePopup();this.manageToken()}else{$("#popManageTokenSetMobile .input_bg").addClass("error_bg");switch(ah.result){case 1200444:$("#popManageTokenSetMobile .empty_phone").showError(ah.result);break;case 1200445:$("#popManageTokenSetMobile .wng_fmt").showError(ah.result);break;case 1200446:$("#popManageTokenSetMobile .bad_param").showError(ah.result);break;case 1200448:$("#popManageTokenSetMobile .dupl_phone").showError(ah.result);break;case 1200449:$("#popManageTokenSetMobile .set_fail").showError(ah.result);break;case 5200451:case 5200450:case 5200447:case 5000000:$("#popManageTokenSetMobile .sys_err").showError(ah.result);break;default:$("#popManageTokenSetMobile .set_fail").showError(ah.result)}}},this)})},this));$("#popManageTokenStatus .delBackupPhone").click(function(ab){ab.preventDefault();if(!H()){return}MiAccountVerification({url:"/pass/auth/security/deleteBackupPhone?userId="+$(".na-num").text(),user:$(".na-num").text(),deviceType:JSP_VAR.deviceType,success:n.proxy(function(){$("#popManageTokenStatus .sys_err").hideError();if(!H()){return}$.ajax({url:"/pass/auth/security/deleteBackupPhone",dataType:"text",type:"POST",data:{passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",userId:$(".na-num").text()},error:C,success:function(ac){ac=ac.replace("&&&START&&&","");ac=$.parseJSONSafe(ac);if(ac.result===0){$("#popManageTokenStatus li:first-child dd .fb_mobile span").text("");$("#popManageTokenStatus li:first-child dd").removeClass("has_fb_mobile")}else{switch(ac.result){case 5200452:case 5200453:case 5200455:case 5000000:$("#popManageTokenStatus .sys_err").showError(ac.result);break;case 1200454:$("#popManageTokenStatus .backup_phone_not_exists").showError(ac.result);break;default:}}}})},this),fail:function(ac){w(ac)}})});$("#popManageTokenKeys .sendEmail").click(function(ad){var ac=[];$("#popManageTokenKeys .mi_code span:not([_used])").each(function(af,ag){ac.push($.trim($(ag).text()))});var ae="?subject="+encodeURIComponent(v.getResource("jsp_2014_my_backup_keys"))+"&body="+ac.join("       ");var ab=ad.target.href;if(ab.indexOf("subject=")===-1){ab+=ae}else{ab=ab.replace(/\?.*$/g,ae)}ad.target.href=ab});$("#popUpdatePassword .oldPass, #popUpdatePassword .newPass, #popUpdatePassword .newPass2, #popUpdatePassword .capt_box").keypress(function(ab){if(ab.keyCode===13){ab.preventDefault();$("#popUpdatePassword .btnOK").click()}});$("#popEnterNewEmail .binding .new_email, #popEnterNewEmail .binding .capt_box").keypress(function(ab){if(ab.keyCode===13){ab.preventDefault();$("#popEnterNewEmail .binding .btn_commom").click()}});$("#popEnterNewEmail .verify .capt_box").keypress(function(ab){if(ab.keyCode===13){ab.preventDefault();$("#popEnterNewEmail .verify .btn_commom").click()}});$("#popEnterNewPhone .binding .new_phone, #popEnterNewPhone .binding .capt_box").keypress(function(ab){if(ab.keyCode===13){ab.preventDefault();$("#popEnterNewPhone .binding .btn_commom").click()}});$("#popEnterNewPhone .verify .phone_capt").keypress(function(ab){if(ab.keyCode===13){ab.preventDefault();$("#popEnterNewPhone .verify .btn_commom").click()}});$("#printKeys").click(function(ab){ab.preventDefault();window.print()});var T=$("#popManageTokenStatus");var aa=$("#popManageTokenKeys");$(window).resize(y.debounce(function(){T.positionPopup();aa.positionPopup()}));$("#popVeriFailed .btn_back").click(function(ac){ac.preventDefault();var ab=$(ac.target);var ad=ab.closest(".mod_acc_tip");ad.hidePopup()})},resetUpdatePasswordForm:function(I){I=I||{};var J=$("#popUpdatePassword");J.find(".error_bg").removeClass("error_bg");J.find(".grpOldPass .err_tip, .capt_box .err_tip").hideError();if(!I.keepInputs){J.find("input[type=text], input[type=password]").not(".pld").val("");$.placehold.removepld(J);$.placehold.init(J)}},onUpdatePasswordSuccess:function(){$("#popUpdatePassword").hidePopup();$("#popUpdatePasswordSuccess").showPopup();var I=new y.Countdown({duration:10000,onProgress:function(J){$("#popUpdatePasswordSuccess .logoutCountdown").text(Math.round(J.timeLeft/1000))},onComplete:function(){location.href="/"}});I.start();d("changePassword","end")},onUpdatePassword:function(J){var L=$("#popUpdatePassword");if(!q(L)){return false}if(JSP_VAR.isPasswordSet&&L.find(".oldPass").val()===L.find(".newPass").val()){s(L.find('input[name="repassword"]'),"not_same_pwd");return false}this.resetUpdatePasswordForm({keepInputs:true});if(!H()){return}var K="";var I={passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",userId:$(".na-num").text(),password:$("#popUpdatePassword .newPass").val(),icode:$.trim($("#popUpdatePassword .chkcode input").val())};if(JSP_VAR.isPasswordSet){I.oldPassword=$("#popUpdatePassword .oldPass").val();K="/pass/auth/security/changePassword"}else{K="/pass/auth/security/newUserSetPassword"}$.ajax({url:K,type:"POST",dataType:"text",data:I,error:C,success:n.proxy(function(N){N=N.replace("&&&START&&&","");N=$.parseJSONSafe(N);var M=N.result;if(M===0){this.onUpdatePasswordSuccess()}else{switch(M){case 110021001:case 110041001:case 1200106:s(L.find('input[name="password"]'),"password_resError");break;case 1200102:case 1200104:s(L.find('input[name="repassword"]'),"repassword_format_error");break;case 1200107:case 1200105:s(L.find('input[name="icode"]'),"icode_rule");break;case 550065002:case 550001008:case 550025000:case 550065000:case 5200107:case 5200108:case 5200109:case 5200111:case 5000000:s(L.find('input[name="password"]'),"error_system",M,true);break;case 4200104:s(L.find('input[name="password"]'),"too_frequently",M,true);break;case 1200110:s(L.find('input[name="repassword"]'),"pwd_risk_error");break;case 4200112:s(L.find('input[name="repassword"]'),"pwd_in_black");break;default:}if(JSP_VAR.isPasswordSet){if(N.info&&N.info.captchaUrl){this.requirePasswordCaptcha(N.info.captchaUrl);L.css("margin-top",-Math.max(Math.round(L.prop("offsetHeight")/2))+"px")}}}},this)});return true},requirePasswordCaptcha:function(J){J=J||"/pass/getCode?icodeType=antispam";J+="&_t="+(+new Date);var I=$("#popUpdatePassword");I.find(".chkcode_img").attr("src",J);I.find('[name="icode"]').val("");I.find(".capt_box").show()},checkBindStatus:function(K,O,P,N){var J=K.find(".bind-info-panel");var M=$.trim(O.find(".set_qst_tit em").text());var L=$.trim(O.find(".capt_box").val());if(M==="+86"){M=""}var I=$.trim(M+P);$.ajax({url:"/pass/auth/security/checkUserBindInfo",type:"POST",dataType:"text",data:{userId:$(".na-num").text(),addressType:N,newAddress:I,icode:L,passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||""},success:n.proxy(function(Q){Q=$.parseJSONSafe(Q.replace("&&&START&&&",""));if(Q.result===0){var Q=Q.info;if(Q.times===0){s(O.find(".new_phone"),"bindLeftTimes")}else{if(Q&&Q.userId&&/\*+/.test(Q.userId)){J.find(".bind-time").text(Q.ts);J.find(".bind-id").text(Q.userId);O.hide();J.show()}else{this.checkNewPhone()}}}else{if(Q.result===1200262){O.find(".chkcode_img").click();O.find(".capt_box").val("");s(O.find(".capt_box"),"icode_rule")}else{if(Q.result===1200263){s(O.find(".new_phone"),"phone_rule",Q.result)}else{if(Q.result===5200264||Q.result===5200265||Q.result===5200266){s(O.find(".capt_box"),"error_system",Q.result,true)}else{s(O.find(".capt_box"),"error_system",Q.result,true)}}}}},this)})},checkNewPhone:function(){var R=$("#popEnterNewPhone");var M=R.find(".binding");var I=R.find(".bind-info-panel");var Q=M.find(".new_phone").val();var O=$.trim(M.find(".set_qst_tit em").text());if(O==="+86"){O=""}var K=O+Q;var P=O;if(!P){P="+86"}var L=R.find(".verify");L.find(".disten30x103 h6 em").text(" "+P+" "+Q+" ");L.find(".err_tip").hide();$("#popEnterNewPhone .binding .full_new_phone").val(O+Q);var N=this.updatePhoneSMSSender;var J=this.updatePhoneSMSSender.quotaCache[K];if(typeof J==="number"){if(J>0){this.updatePhoneSMSSender.onSendSMS()}else{s(M.find(".new_phone"),"reachMax");I.hide();M.show();return false}}},checkQuota:function(I){if(!H()){return}var N=$("#popEnterNewPhone .binding");var J=N.find(".new_phone").val();var L=$.trim(N.find(".set_qst_tit em").text());if(L==="+86"){L=""}var K=L+J;$("#popEnterNewPhone .binding .full_new_phone").val(K);var M=this.updatePhoneSMSSender;$.ajax({url:M.quotaURL,dataType:"text",type:"POST",data:M.getQuotaPostData?M.getQuotaPostData():{address:M.$phoneBox.val(),contentType:M.type,userId:M.type?M.$userBox.val():-1},error:C,success:n.proxy(function(P){P=$.parseJSONSafe(P.replace("&&&START&&&",""));var O=+P.info||0;M.quotaCache[K]=O;M.showQuota(M.quotaCache[K]);if(P.result===0){I&&I(parseInt(P.info)||0)}else{I&&I(0)}},this)})},checkNewEmail:function(M){var K=this;var I=$("#popEnterNewEmail");var L=I.find(".binding");var J=L.find(".new_email").val();if(!J){L.find(".empty_email").showError();return false}if(!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(J)){L.find(".wng_fmt").showError();return false}if(!H()){return}M();return;$.ajax({url:"/pass/auth/security/checkSafeAddressParams",type:"POST",data:{passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",addressType:"EM",userId:$(".na-num").text(),newAddress:J,icode:$.trim(L.find(".capt_box").val()),replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},dataType:"text",error:C,success:n.proxy(function(N){N=N.replace("&&&START&&&","");N=$.parseJSONSafe(N);if(N.result===0){if(M){M()}}else{L.find(".chkcode_img").click();L.find(".capt_box").val("");$("#popEnterNewEmail .binding .capt_box").val("").parent().addClass("error_bg");clearTimeout(K.emailImageBlurTimer);switch(N.result){case 1200216:L.find(".wng_fmt").showError(N.result);break;case 1200205:L.find(".email_bound").showError(N.result);break;case 1200207:L.find(".email_bound_elsewhere").showError(N.result);break;case 5200203:case 5200204:case 5200206:case 5000000:L.find(".sys_err").showError(N.result);break;case 1200201:L.find(".wng_capt").showError(N.result);break;case 1200202:L.find(".bad_param").showError(N.result);break;default:}}},this)})},onEnterNewPhone:function(N){var J=$("#popEnterNewPhone");var M=J.find(".binding");M.find(".err_tip").hideError();var I=M.find(".new_phone").val();var L=$.trim(M.find(".set_qst_tit em").text()||"");if(L==="+86"){L=""}var K=L+I;if(!q(M)){return false}this.updatePhoneSMSSender.onResend=false;if(typeof this.updatePhoneSMSSender.quotaCache[K]==="number"){if(this.updatePhoneSMSSender.quotaCache[K]===0){s(M.find(".new_phone"),"reachMax")}else{this.checkBindStatus(J,M,I,"PH")}}else{this.checkQuota(n.proxy(function(O){if(O===0){s(M.find(".new_phone"),"reachMax")}else{this.updatePhoneSMSSender.smsDisabled=true;this.checkBindStatus(J,M,I,"PH")}},this))}if(N){N.preventDefault()}return false},onVerifyNewEmail:function(N){if(N){N.preventDefault()}var M=this;var J=$("#popEnterNewEmail");var I=J.find(".verify");var L=J.find(".success");var K=$.trim(I.find(".capt_box").val());if(!K){I.find(".empty_capt").showError();I.find(".capt_box").parent().addClass("error_bg");return}if(!H()){return}$.ajax({type:"post",dataType:"text",url:"/pass/auth/security/bindSafeAddress",data:{vkey:$.trim(I.find(".capt_box").val()),userId:$(".na-num").text(),newAddress:$("#popEnterNewEmail .binding .new_email").val(),passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",addressType:"EM",edm:$("#popEnterNewEmail .binding .select-edm").hasClass("now")?"true":"false",replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},error:C,success:function(O){O=O.replace("&&&START&&&","");O=$.parseJSONSafe(O);if(O.result===0){I.find(".capt_box").parent().removeClass("error_bg");$(J.find(".tab_opt span").removeClass("now")[2]).addClass("now");$(J.find(".tabline i").removeClass("now")[2]).addClass("now");I.hide();L.show();d("changeEmail","end")}else{I.find(".err_tip").hideError();I.find(".capt_box").parent().addClass("error_bg");switch(O.result){case 1200212:I.find(".wng_capt").showError(O.result);break;case 5200213:case 5200214:case 5000000:I.find(".sys_err").showError(O.result);break;default:}}}})},onVerifyNewPhone:function(O){if(O){O.preventDefault()}var K=$("#popEnterNewPhone");var I=K.find(".verify");var L=K.find(".success");if(!q(I)){return false}var M=$("#popEnterNewPhone").data("action")==="update"?"/pass/auth/security/updatePhone":"/pass/auth/security/addPhone";var N=$("#popEnterNewPhone").data("phone");var P=$("#popEnterNewPhone").data("key");if(!H()){return}var J=$.trim($("#popEnterNewPhone .binding .full_new_phone").val());$.ajax({type:"POST",dataType:"text",url:M,data:{userId:$(".na-num").text(),vkey:$.trim($("#popEnterNewPhone .verify .phone_capt").val()),passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",newPhone:J,oldPhoneKey:P,oldPhone:N,phone:J},error:C,success:function(Q){Q=Q.replace("&&&START&&&","");Q=$.parseJSONSafe(Q);if(Q.result===0){$(K.find(".tab_opt span").removeClass("now")[2]).addClass("now");$(K.find(".tabline i").removeClass("now")[2]).addClass("now");I.hide();L.show();d("changePhone","end");p.set("passInfo","bindph-end",{domain:".account.xiaomi.com"})}else{K.find(".verify .err_tip").hideError();switch(Q.result){case 4200219:case 4200243:case 4200250:s(I.find("input[name=ticket]"),"phoneBindTomuch");break;case 1200212:case 1200241:case 1200248:s(I.find("input[name=ticket]"),"ticket_resError");break;default:s(I.find("input[name=ticket]"),"error_system",Q.result)}}}});return false},cancelUpdatePhone:function(J){$("#popEnterNewPhone").hidePopup();var I=this.updatePhoneSMSSender;I.countdown&&I.countdown.stop();I.sendTimes=0;if(J){J.preventDefault()}return false},showTip:function(I){},hideTip:function(I){},editPassword:function(){if(!H()){return}$.ajax({url:"/pass/auth/security/changePassword",type:"get",dataType:"text",data:{userId:$(".na-num").text()},error:C,success:n.proxy(function(I){I=I.replace("&&&START&&&","");I=$.parseJSONSafe(I);if(I.result===0){var J=$("#popUpdatePassword");J.showPopup().find(".err_tip").hide();J.find(".grpNewPass .txt_tip").show();if(I.info.captchaUrl&&JSP_VAR.isPasswordSet){this.requirePasswordCaptcha(I.info.captchaUrl)}else{$("#popUpdatePassword .capt_box").hide()}J.css("margin-top",-Math.max(Math.round(J.prop("offsetHeight")/2))+"px")}},this)})},updatePassword:function(){},editEmail:function(){},updateEmail:function(){},enterNewPhone:function(I){window.console&&window.console.log&&window.console.log(I);var K=$("#popEnterNewPhone");if(I&&I.action){K.data("action",I.action);K.data("phone",I.phone);K.data("key",I.key)}$(K.find(".tab_opt span").removeClass("now")[0]).addClass("now");$(K.find(".tabline i").removeClass("now")[0]).addClass("now");K.find(".binding").show();K.find(".bind-info-panel").hide();K.find(".verify").hide();K.find(".success").hide();K.find("input").not(".pld").val("");K.find(".error_bg").removeClass("error_bg");K.find(".err_tip").hideError();var J=K.find(".chkcode_img");J.attr("src",J.attr("_src")+"&_t="+y.now());$.placehold.removepld(K);$.placehold.init(K);K.showPopup()},enterNewEmail:function(){var J=$("#popEnterNewEmail");$(J.find(".tab_opt span").removeClass("now")[0]).addClass("now");$(J.find(".tabline i").removeClass("now")[0]).addClass("now");J.find(".binding").show();J.find(".verify").hide();J.find(".success").hide();J.find("input").not(".pld").val("");J.find(".error_bg").removeClass("error_bg");J.find(".err_tip").hideError();var I=J.find(".chkcode_img");I.attr("src",I.attr("_src")+"&_t="+y.now());$.placehold.removepld(J);$.placehold.init(J);J.showPopup()},setMibao:function(){var K=$("#popSetMibao");K.find(".error-mes").html("").hide();var I=$("#frmSetQuestions ul > li");I.each(function(M,N){var L=$(N);var O=L.find('dd[_type^="-"]');if(!O.length){O=L.find("dd.def-opt")}O.click()});$("#frmSetQuestions").trigger("reset");K.showPopup();var J=$("#popAnswerMibao");J.find("li label input").val("");J.find("li > p").html("")},answerMibao:function(J){var K=$("#popAnswerMibao");K.find(".error-mes").text("").hide();if(J&&J.list&&J.list.length){var I=K.find(".set_mibao li p");I.each(function(L,M){$(M).text(J.list[L].q)})}K.showPopup()},manageToken:function(){var K;var I=$("#btnManageToken a");var J=I.attr("__href");if(J.indexOf("status")>-1){K=$("#popManageTokenStatus")}else{if(J.indexOf("explain")>-1){K=$("#popManageTokenHome")}}if(K){if(K.attr("id")==="popManageTokenStatus"){if(!H()){return}$.ajax({url:"/pass/auth/security/twoStepLoginStatus",type:"GET",dataType:"text",data:{userId:$(".na-num").text(),_:+new Date},error:C,success:function(L){L=L.replace("&&&START&&&","");L=$.parseJSONSafe(L);var M=L.info.hasBackupPhone;if(M){K.find("li:first-child dd .fb_mobile span").text(L.info.backupPhone);K.find("li:first-child dd").addClass("has_fb_mobile")}else{K.find("li:first-child dd").removeClass("has_fb_mobile")}K.find(".err_tip").hideError();K.showPopup()}})}else{K.find(".err_tip").hideError();K.showPopup()}}},confirmMibao:function(){var I=$("#popAnswerMibao");I.showPopup()},emailSendTimes:0,emailCaptBlurTimer:null,sendLeftTimes:null,onResendNewEmail:function(P){clearInterval(this.emailCaptBlurTimer);var I=$("#popEnterNewEmail");var Q=I.find(".resend");var L=I.find(".verify");var O=I.find(".binding");var R=$("#emailQuotaTextLabel");if(!H()){return}var K={};!this.emailSendTimes&&(K.icode=O.find(".capt_box").val());var J=n.proxy(function(){$.ajax({url:"/pass/sms/quota",dataType:"text",type:"POST",data:{address:I.find(".new_email").val(),contentType:150007,userId:$(".na-num").text()},error:C,success:n.proxy(function(T){T=T.replace("&&&START&&&","");T=$.parseJSONSafe(T);if(T.result==0){var S=+T.info||0;this.sendLeftTimes=S}},this)})},this);var M=n.proxy(function(S){if(S<=2){R.show();var T=R.text().replace("{left}",S);R.text(T)}else{R.hide()}},this);var N=n.proxy(function(){$.ajax({type:"POST",url:"/pass/auth/security/sendSafeAddressTicket",data:$.extend({passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",userId:$(".na-num").text(),newAddress:I.find(".new_email").val(),addressType:"EM",replace:$("#btnUpdateEmail a").attr("__href").indexOf("replace=true")>-1},K),dataType:"text",error:C,success:n.proxy(function(V){V=V.replace("&&&START&&&","");V=$.parseJSONSafe(V);var S=V.result||V.code;if(V.result===0){Q.addClass("noSend");var U=60000+60000*this.emailSendTimes++,T=100;var X=new Date;var W=Q.attr("title");this.timer=setInterval(n.proxy(function(){var Y=new Date;var aa=Y-X;var Z=U/1000-Math.round(aa/1000);if(Z>0){Q.text(W+"("+Z+")")}else{Q.removeClass("noSend").text(W);clearInterval(this.timer)}},this),T);$(I.find(".tab_opt span").removeClass("now")[1]).addClass("now");$(I.find(".tabline i").removeClass("now")[1]).addClass("now");this.sendLeftTimes=Math.max(this.sendLeftTimes-1,0);if(this.sendLeftTimes===0){Q.addClass("noSend").text(W);clearInterval(this.timer)}M(this.sendLeftTimes);O.hide();L.show()}else{L.find(".err_tip").hideError();O.find(".chkcode_img").click();O.find(".capt_box").val("");Q.removeClass("noSend").text(W);clearInterval(this.timer);if(S===1200201||S===87001){O.find(".capt_box").val("").parent().addClass("error_bg");O.find(".wng_capt").showError(S)}switch(V.result){case 1200216:case 1200258:O.find(".new_email").val("").parent().addClass("error_bg");O.find(".wng_fmt").showError(V.result);break;case 1200205:case 1200259:O.find(".new_email").val("").parent().addClass("error_bg");O.find(".email_bound").showError(V.result);break;case 1200207:case 1200260:O.find(".new_email").val("").parent().addClass("error_bg");O.find(".email_bound_elsewhere").showError(V.result);break;case 5200203:case 5200204:case 5200206:case 5200261:case 5000000:O.find(".sys_err").showError(V.result);break;case 1200201:O.find(".capt_box").val("").parent().addClass("error_bg");O.find(".wng_capt").showError(V.result);break;case 1200202:O.find(".bad_param").showError(V.result);break;case 1200210:O.find(".new_email").val("").parent().addClass("error_bg");O.find(".err_tip.reach_max").showError(V.result);break;default:}switch(V.result){case 5200209:case 5000000:L.find(".err_tip.sys_err").showError(V.result);break;default:}}},this)})},this);if(!this.initQuota){this.initQuota=1;J()}if(!Q.hasClass("noSend")){Q.addClass("noSend");N()}},cancelUpdateEmail:function(K){K.preventDefault();var I=$("#popEnterNewEmail");I.hidePopup();var J=I.find(".resend");var L=J.attr("title");J.removeClass("noSend").text(L);this.emailSendTimes=0;clearInterval(this.timer)},onEnterNewEmail:function(M){var I=$("#popEnterNewEmail");var L=I.find(".binding");L.find(".err_tip").hideError();var J=L.find(".new_email").val();if(!J){L.find(".empty_email").showError();L.find(".new_email").parent().addClass("error_bg");if(M){M.preventDefault()}return false}if(!/^[\w.\-]+@(?:[a-z0-9]+(?:-[a-z0-9]+)*\.)+[a-z]{2,6}$/.test(J)){L.find(".wng_fmt").showError();L.find(".new_email").parent().addClass("error_bg");if(M){M.preventDefault()}return false}var K=$.trim(I.find(".capt_box").val());if(!K){L.find(".empty_capt").showError();I.find(".capt_box").parent().addClass("error_bg");if(M){M.preventDefault()}return false}this.checkNewEmail(function(){var N=I.find(".verify");N.find(".disten30x103 h6 em").text(" "+J+" ");$("#popEnterNewEmail .verify .resend").click()});if(M){M.preventDefault()}return false},updatePhone:function(){},editMibaoQuestions:function(){},updateMibaoQuestions:function(){},enableToken:function(){},disableToken:function(){}});var B=n.$class({constructor:function(I){I=I||{};profilesgp=I.sgp},syncHash:function(){var J=m.parse(location.hash);var K=location.hash;if(K===b){return}var I=J.service||"";b=K;switch(I){case"switchRegion":d("switchRegion");$("#switchRegion").click();break;default:$("#popSwitchRegion").hidePopup()}},uploadingPhoto:false,render:function(){$(document.body).delegate(".mod_acc_tip .btn_mod_close, .btn_back","click",n.proxy(function(az){az.preventDefault();var ax=$(az.target),aB=az.target.id,aA=ax.closest(".mod_acc_tip"),ay=aA.attr("id");switch(aB){case"reuploadPhoto":$("#photoUploader")[0].reset();$($(".layeruploadface .mod_tip_bd").hide()[0]).showPopup();$(".uploadimgs img").removeAttr("style").removeAttr("src");break;case"abortUpload":this.uploadingPhoto=false;$(az.target).closest(".mod_acc_tip").hidePopup();$(".naImgLink a").click();$("#uploadPhoto").attr("src","about:blank");$(".uploadimgs img").removeAttr("style").removeAttr("src");break;default:$(az.target).closest(".mod_acc_tip").hidePopup()}},this));$(".main_l").click(function(ax){ax.preventDefault();ax.stopPropagation();if(JSP_VAR.deviceType!=="mobile"){return}$(ax.currentTarget).find(".naImgLink a").click()});var I=2013;var ac='<div class="select_panel select-year-panel">';for(var ar=I;ar>=1900;ar--){ac+='<p value="'+ar+'">'+ar+"</p>"}ac+="</div>";$(".select-year").prepend(ac);var aq=$(".select-year-panel");var L=new Date().getFullYear();var Z="";if(aq.length&&L>I){for(var ar=L;ar>I;ar--){Z+='<p value="'+ar+'">'+ar+"</p>"}aq.prepend(Z)}$(".birth-box .btn-cancel").bind("click",function(ax){ax.stopPropagation();$(this).closest(".tits_list").hide()});$(".titsbirth").bind("click",function(ax){ax.stopPropagation();$(ax.target).closest("li").find(".tits_list").toggle()});$(document.body).click(function(ax){$(".tits_list").hide()});$(".birth-box").delegate(".tits_list","click",function(ax){ax.stopPropagation()});$(".birth-box").delegate(".tits_list p","click",function(aA){var ax=$(aA.target);var ay=ax.closest("li");var az=ax.attr("value");if(ay.hasClass("biry")){ae(az)}else{if(ay.hasClass("birm")){av(az)}else{Y(az)}}ax.closest(".tits_list").hide();$(".layereditinfo ul").trigger("birthChange")});$(".layereditinfo ul").bind("birthChange",function(){$(".layereditinfo .error-birth").hideError()});$(".infosex span").click(function(az){var ax=$(az.target);var ay=ax.closest(".infosex");ay.find("span").removeClass("now");ax.closest("span",true).addClass("now")});function ad(ax){$(".infosex span").removeClass("now");!!ax&&$(".infosex span[value="+ax+"]").addClass("now")}function W(ax){ax=+ax;return(ax%100!==0&&ax%4===0)||(ax%100===0&&ax%400===0)}function ao(az,aA,ay){az=parseInt(az,10);aA=parseInt(aA,10);ay=parseInt(ay,10);var ax=W(az);var aB=K.concat([]);if(ax){aB[2]=29}if(ay<=aB[aA]){return true}else{return false}}var K=[0,31,28,31,30,31,30,31,31,30,31,30,31];var am=new Date,aw=am.getFullYear(),J=am.getMonth()+1,ai=am.getDate();function ae(az){if(!az){$(".biry .birthcon").text(MSG.year);return}$(".biry .birthcon").text(az);if(az==aw){$(".birm .tits_list p").each(function(aB,aC){var aD=parseInt(aC.getAttribute("value"),10);if(aD<=J){$(aC).show()}else{$(aC).hide()}})}else{$(".birm .tits_list p").show()}var ay=$(".biry .birthcon").text(),aA=$(".birm .birthcon").text(),ax=$(".bird .birthcon").text();if(isNaN(ay)||isNaN(aA)||isNaN(ax)){return}if(!ao(ay,aA,ax)){$(".bird .birthcon").text(MSG.date)}av(aA)}function av(az){if(!az){$(".birm .birthcon").text(MSG.month);return}$(".birm .birthcon").text(az);az=parseInt(az,10);var aB=K[az];if(W($(".biry .birthcon").text())&&az===2){aB=29}$(".bird .tits_list p").each(function(aC,aD){if(aC<aB){$(aD).show()}else{$(aD).hide()}});if($(".biry .birthcon").text()==aw&&parseInt($(".birm .birthcon").text())===J){$(".bird .tits_list p").each(function(aD,aE){var aC=parseInt(aE.getAttribute("value"),10);if(aC<=ai){$(aE).show()}else{$(aE).hide()}})}else{}var ay=$(".biry .birthcon").text(),aA=$(".birm .birthcon").text(),ax=$(".bird .birthcon").text();if(isNaN(ay)||isNaN(aA)||isNaN(ax)){return}if(!ao(ay,aA,ax)){$(".bird .birthcon").text(MSG.date)}else{Y(ax)}}function Y(ax){if(!ax){$(".bird .birthcon").text(MSG.date);return}$(".bird .birthcon").text(ax)}$(".country-container-panel").each(function(ay,az){var ax=$("<div>").addClass("country-container");ax.html(RegionsCode.getAll({usual:"常用"},true));$(az).append(ax)});$("#popSwitchRegion .country-container").delegate(".record","click",function(aA){var ax=$(aA.target),aB=ax.closest(".listwrap").find("tt");var az=ax.closest(".record");var ay=az.find(".record-country");aB.text(ay.text()).attr("_code",ay.data("brief"));ax.closest(".country-container").hide();aA.preventDefault()});$("#continueSwitch").click(function(ay){ay.preventDefault();var ax=$("#popSwitchRegion > .mod_tip_bd");$(ax[0]).hide();$(ax[1]).show()});$(document.body).click(function(ax){$(".country-container").hide()});$(".country-container-panel .btn-cancel").bind("click",function(ax){ax.stopPropagation();$(this).closest(".country-container").hide()});$(".country-container-panel .country-container").bind("click",function(ax){ax.stopPropagation()});$("#popSwitchRegion .listtit").click(function(ax){ax.stopPropagation();$("#popSwitchRegion .country-container-panel").toggle()});$("#doRegionSwitch").click(function(ax){ax.preventDefault();if(!H()){return}$("#popSwitchRegion .err_tip").hideError();if(!$("#popSwitchRegion .listtit tt").attr("_code")){$("#popSwitchRegion .empty_region").showError();return}if(!H()){return}$.ajax({url:"/pass/auth/profile/userRegion",type:"POST",dataType:"text",data:{userId:$(".na-num").text(),region:$("#popSwitchRegion .listtit tt").attr("_code"),passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||""},error:C,success:function(ay){ay=ay.replace("&&&START&&&","");ay=$.parseJSONSafe(ay);if(ay.result===0){$("#popSwitchRegion").hidePopup();location.reload(true)}else{switch(ay.result){case 5200526:case 5200527:$("#popSwitchRegion .sys_err").showError(ay.result);break;case 1200525:$("#popSwitchRegion .bad_param").showError(ay.result);break;default:$("#popSwitchRegion .sys_err").showError(ay.result)}}}})});$("#switchRegion").click(function(aB){return;aB.preventDefault();if(!H()){return}var az=$("#popSwitchRegion > .mod_tip_bd");$("#popSwitchRegion .err_tip").hideError();$(az[0]).show();$(az[1]).hide();var aA=$("#region");var ax=aA.attr("_code")||"";var aD=$('#popSwitchRegion .country-container .record-country[data-brief="'+ax+'"]')[0];aD=$(aD);if(aD.length){var ay=$.trim(aD.data("brief")),aC=$.trim(aD.text());$("#popSwitchRegion .listtit tt").attr("_code",ay).text(aC)}$("#popSwitchRegion").showPopup()});(function(){var ay=$("#region");var ax=ay.attr("_code")||"";var aA=$('#popSwitchRegion .country-container .record-country[data-brief="'+ax+'"]')[0];aA=$(aA);if(aA.length){var az=$.trim(aA.text());ay.text(az)}})();$("#editInfo, #editInfoWap").click(function(aD){aD.preventDefault();if(!H()){return}var ax=$(".layereditinfo");ax.find(".err_tip").hideError();var ay=$(".uinfo");var aA=$.trim(ay.find(".lblnickname .value").text());if(ay.find(".lblnickname .value").attr("_empty")!==undefined){aA="";$.placehold.removepld(ax);$.placehold.init(ax)}$("input[name=nickname]").val(aA);var aH=$.trim(ay.find(".lblbirthday .value").text());if(ay.find(".lblbirthday .value").attr("_empty")!==undefined){aH=""}if(/\d+\/\d+\/\d+/.test(aH)){var aF=aH.split("/");aF.reverse();aH=aF.join("-")}var aB=aH.split("-"),aE=aB[0],aC=aB[1],az=aB[2];ae(aE);av(aC);Y(az);var aG=$.trim(ay.find(".lblgender .value").attr("val"));ad(aG);ax.showPopup()});$(".layereditinfo .nickname").on("focus click",function(ax){$(".layereditinfo .err_tip").hideError()});function ap(ax){ax=""+ax;if(ax.length===1){ax="0"+ax}return ax}$(".layereditinfo .btn_commom").click(function(aE){aE.preventDefault();if(!H()){return}var ax=$.trim($(".layereditinfo .nickname").val());var aC="";var aA=parseInt($(".layereditinfo .biry .birthcon").text(),10),aD=parseInt($(".layereditinfo .birm .birthcon").text(),10),ay=parseInt($(".layereditinfo .bird .birthcon").text(),10);var aB;var az=new Date().setFullYear(aw-13);if(!ax){$(".layereditinfo .empty_name").showError();$(".layereditinfo .nickname").parent().addClass("err_label");return}if(ax.length<2||ax.length>20){$(".layereditinfo .bad_nickname").showError();$(".layereditinfo .nickname").parent().addClass("err_label");return}if(/[\/<>\%]+/.test(ax)){$(".layereditinfo .mismatch_nickname").showError();$(".layereditinfo .nickname").parent().addClass("err_label");return}if(!aA&&!aD&&!ay){aC=""}else{if((aA||aD||ay)&&(!aA||!aD||!ay)){$(".layereditinfo .empty_birthday").showError();return}else{if(az-new Date().setFullYear(aA)<0&&profilesgp){$(".layereditinfo .invalid_birthday").showError();return}else{aC=[aA,ap(aD),ap(ay)].join("-")}}}aB=32-(new Date(aA,aD-1,32)).getDate();if(ay>aB){$(".bird .birthcon").text(MSG.date)}if(!H()){return}$.ajax({type:"POST",dataType:"text",url:"/pass/auth/profile/userProfile",data:{nickname:ax,birthday:aC,gender:$(".layereditinfo .infosex .now").attr("value")||"",userId:$(".na-num").text(),passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||""},error:C,success:function(aF){aF=aF.replace("&&&START&&&","");aF=$.parseJSONSafe(aF);if(aF.result===0){$(".layereditinfo").hidePopup();location.reload(true)}else{$(".layereditinfo .err_tip").hideError();switch(aF.result){case 1200503:$(".layereditinfo .empty_param").showError(aF.result);break;case 1200504:$(".layereditinfo .bad_nickname").showError(aF.result);break;case 1200511:$(".layereditinfo .mismatch_nickname").showError(aF.result);break;case 1200505:$(".layereditinfo .bad_birthday").showError(aF.result);break;case 1200506:$(".layereditinfo .bad_gender").showError(aF.result);break;case 1200507:$(".layereditinfo .bad_param").showError(aF.result);break;case 1200528:$(".layereditinfo .black_nickname").showError(aF.result);break;case 1200508:case 5200509:case 5200510:case 5000000:$(".layereditinfo .sys_err").showError(aF.result);break;default:}}}})});$(".uplodefile").change(n.proxy(function(aE){if(!H()){return}$(".layeruploadface").find(".err_tip").hide();var aC=aE.target.files;if(aC&&aC.length){var az=aC[0];if(az.size>1<<21){s($(".uplode_img"),"fileTooLarge","",true);return}}var ay=aE.target.value,aB=aE.target.form,ax=$(aB);if(ay){var aD=ay.lastIndexOf(".");if(aD!==-1){var aA=ay.substring(aD+1).toLowerCase();if(aA!=="png"&&aA!=="jpg"){s($(".uplode_img"),"formatError","",true);return}}}else{return}$(".layeruploadface .err_tip").hideError();this.uploadingPhoto=true;if(!H()){return}$.ajax({type:"POST",url:"/pass/auth/profile/requestUpload",dataType:"text",data:{userId:$(".na-num").text(),passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",quality:"1.0",isRedirect:"true"},error:C,success:n.proxy(function(aF){aF=aF.replace("&&&START&&&","");aF=$.parseJSONSafe(aF);if(aF.result===0){$(".layeruploadface .preupload").hide();$(".layeruploadface .uploading .err_tip").hideError();$(".layeruploadface .uploading").show();var aG=aF.info.tempUploadUrl;aB.action=aG;ax.submit()}else{switch(aF.result){case 5200512:case 5200513:case 5000000:s($(".uplode_img"),"error_system","",true);break;default:}}},this)})},this));$(".naImgLink a, .na-edit").click(function(ax){ax.stopPropagation();ax.preventDefault();if(!H()){return}var ay=$(".layeruploadface");ay.find(".err_tip").hideError();ay.find("form").trigger("reset");$(ay.find(".mod_tip_bd").hide()[0]).show();ay.showPopup()});var X=100;var M=$("#clipimage");var N=$(".movebox");var ak,al,Q,S;M.load(n.proxy(function(aD){if(!this.uploadingPhoto){return}var ax=$(aD.target),aB=ax.parent();$(".layeruploadface .uploading").hide();$(".layeruploadface .uploaded .err_tip").hideError();$(".layeruploadface .uploaded").show();$("#img_cache").append(ax);var aF=ax.width();imgHeight=ax.height();ak=Math.min(300,$(".layeruploadface .uploaded .clipimg").width());al=Math.min(300,$(".layeruploadface .uploaded .clipimg").height());if(aF>imgHeight){if(aF>ak){imgHeight=Math.floor(imgHeight*ak/aF);aF=ak}}else{if(imgHeight>al){aF=Math.floor(aF*al/imgHeight);imgHeight=al}}ax.css({width:aF+"px",height:imgHeight+"px"}).appendTo(aB);$("#img_cache").html("");X=Math.min(100,Math.min(ax.width(),ax.height()));Q=Math.floor((al-ax.prop("offsetHeight"))/2);S=Math.floor((ak-ax.prop("offsetWidth"))/2);ax.css("top",Q);ax.css("left",S);$(".clipmsk").css({width:aF+"px",height:imgHeight+"px",top:Q,left:S});var aE=Math.floor((ak-X)/2);var aA=Math.floor((al-X)/2);N.css({width:X,height:X,top:aA,left:aE});var az=aA-Q;var ay=aE-S;var aG=N.outerHeight();var aC=N.outerWidth();$(".mskt").css({height:az});$(".mskb").css({height:imgHeight-az-aG});$(".mskl").css({width:ay,height:aG,top:az});$(".mskr").css({width:aF-ay-aC,height:aG,top:az});this.uploadingPhoto=false},this));$(".layeruploadface .btn_mod_close").bind("click",function(ax){ax.preventDefault();ax.stopPropagation();M.removeAttr("style").attr("src","");$(ax.target).closest(".mod_acc_tip").hidePopup()});var P=$("#uploadPhoto"),an=P[0];var V="";function O(ay){var ax=$("<DIV/>").html(ay);var az=ax.text();ax=null;return az}function au(aB){if(an.readyState==="complete"||an.readyState==="loaded"||(aB&&aB.type==="load")){V="";var aA;try{aA=an.contentDocument||(an.contentWindow&&an.contentWindow.document)||an.document;if(!aA){return}}catch(ay){return}var aC=O($(aA).find("textarea.jsonResult").val());var az=aC;az=az.replace("&&&START&&&","");az=$.parseJSONSafe(az);if(!az){s($(".upload-percent"),"error_system",az.result,true);return}if(az.result===0){V=O($(aA).find("textarea.uploadResult").val());var ax=az.info.data.temp_url;M.attr("src",ax)}else{if(az.result===1200521){if(az.info){az.result=az.info.issErrorCode}}switch(az.result){case 90021:s($(".upload-percent"),"fileTooLarge",az.result,true);break;case 90018:s($(".upload-percent"),"formatError",az.result,true);break;case 5200522:case 5200524:case 5000000:s($(".upload-percent"),"error_system",az.result,true);break;case 1200523:s($(".upload-percent"),"missingParam",az.result,true);break;case 80017:s($(".upload-percent"),"missingFile",az.result,true);break;case 10007:s($(".upload-percent"),"unsupportedMimeType",az.result,true);break;default:s($(".upload-percent"),"error_system",az.result,true)}}}}if("onreadystatechange" in an){an.onreadystatechange=au}else{an.onload=au}var T=false;var ah,ag;var at=N[0];function aj(ax){if(ax.type.indexOf("touch")>-1){if(ax.originalEvent.touches&&ax.originalEvent.touches.length){return{pageX:ax.originalEvent.touches[0].pageX,pageY:ax.originalEvent.touches[0].pageY}}}else{return{pageX:ax.pageX,pageY:ax.pageY}}}N.bind("mousedown touchstart",function(ay){ay.preventDefault();ay.stopPropagation();T=true;var ax=aj(ay);ah=ax.pageX-parseInt(N.css("left"),10);ag=ax.pageY-parseInt(N.css("top"),10)});$(document).bind("mousemove touchmove",function(aD){if(T){aD.preventDefault();aD.stopPropagation();if(JSP_VAR.deviceType==="mobile"&&aD.target!==at){T=false;return}var aB=parseInt(M.css("left"),10),aK=aB+M.prop("offsetWidth")-N.prop("offsetWidth");var aJ=parseInt(M.css("top"),10),ax=aJ+M.prop("offsetHeight")-N.prop("offsetHeight");var aL=aj(aD);var aI=aL.pageX-ah;var aG=aL.pageY-ag;if(aI<aB){aI=aB}if(aG<aJ){aG=aJ}if(aI>aK){aI=aK}if(aG>ax){aG=ax}var aE=Math.round((aI-aB)*100/(M.prop("offsetWidth")-N.prop("offsetWidth")))+"%";var aA=Math.round((aG-aJ)*100/(M.prop("offsetHeight")-N.prop("offsetHeight")))+"%";N.css({top:aG,left:aI});var aF=M.width();imgHeight=M.height();var az=aG-Q;var ay=aI-S;var aH=N.outerHeight();var aC=N.outerWidth();$(".mskt").css({height:az});$(".mskb").css({height:imgHeight-az-aH});$(".mskl").css({width:ay,height:aH,top:az});$(".mskr").css({width:aF-ay-aC,height:aH,top:az})}}).bind("mouseup _touchend",function(ax){ax.preventDefault();T=false});var aa=$(".layeruploadface .icon_square_rightbot"),af=aa[0];var ab,R,U=false;aa.bind("mousedown touchstart",function(ay){ay.stopPropagation();ay.preventDefault();U=true;var ax=aj(ay);ab=ax.pageX-parseInt(aa.css("left"),10);R=ax.pageY-parseInt(aa.css("top"),10)});$(document).bind("mousemove touchmove",function(aD){if(U){aD.stopPropagation();aD.preventDefault();if(JSP_VAR.deviceType==="mobile"&&aD.target!==af){U=false;return}var aL=aj(aD);var aH=aL.pageX-ab;var aF=aL.pageY-R;var aB=parseInt(M.css("left"),10),aK=aB+M.prop("offsetWidth")-parseInt(N.css("left"),10);var aJ=parseInt(M.css("top"),10),ax=aJ+M.prop("offsetHeight")-parseInt(N.css("top"),10);var aI=Math.max(aH,aF);var aA=aI;if(aA<X){aA=X}if(aA>aK){aA=aK}if(aA>ax){aA=ax}aA-=2;N.css({height:aA,width:aA});var aE=M.width();imgHeight=M.height();var az=parseInt(N.css("top"),10)-Q;var ay=parseInt(N.css("left"),10)-S;var aG=N.outerHeight();var aC=N.outerWidth();$(".mskb").css({height:imgHeight-az-aG});$(".mskl").css({width:ay,height:aG,top:az});$(".mskr").css({width:aE-ay-aC,height:aG,top:az})}}).bind("mouseup _touchend",function(ax){if(U){U=false;ax.stopPropagation();ax.preventDefault()}});$(".layeruploadface .uploaded .btn_commom").click(function(ax){ax.preventDefault();if(!H()){return}$.ajax({url:"/pass/auth/profile/commitUpload",type:"POST",data:{userId:$(".na-num").text(),passport_ph:p.get("passport_ph")||"",usercenter_ph:p.get("usercenter_ph")||"",passportsecurity_ph:p.get("passportsecurity_ph")||"",passToken:p.get("passToken")||"",uploadResult:V,cropParam:(function(){var aA=parseInt(M.css("left"),10),aC=M.prop("offsetWidth"),aF=N.prop("offsetWidth");var aG=parseInt(M.css("top"),10),aD=M.prop("offsetHeight"),aH=N.prop("offsetHeight");var az=parseInt(N.css("left"),10)-aA,aE=parseInt(N.css("top"),10)-aG,ay=az+aF,aB=aE+aH;az/=aC;aE/=aD;ay/=aC;aB/=aD;if(az<0){az=0}if(az>1){az=1}if(aE<0){aE=0}if(aE>1){aE=1}if(ay<0){ay=0}if(ay>1){ay=1}if(aB<0){aB=0}if(aB>1){aB=1}return'{"x1":'+az+',"y1":'+aE+',"x2":'+ay+',"y2":'+aB+"}"})},dataType:"text",error:C,success:function(ay){ay=ay.replace("&&&START&&&","");ay=$.parseJSONSafe(ay);if(ay.result===0){$(".layeruploadface").showPopup();location.reload(true)}else{$(".layeruploadface .uploaded .err_tip").hideError();switch(ay.result){case 5200517:case 5200518:case 5200519:case 5000000:s(M,"error_system",ay.result,true);break;case 1200514:case 1200516:s(M,"bad_param",ay.result,true);break;case 1200515:s(M,"uploadFailed",ay.result,true);break;case 5200520:s(M,"blackAvatar",ay.result,true);break;default:s(M,"error_system",ay.result,true)}}}})});$(".layereditinfo .nickname").keypress(function(ax){if(ax.keyCode===13){ax.preventDefault();$(".layereditinfo .btn_commom").click()}});this.syncHash();setInterval(n.proxy(function(){this.syncHash()},this),500)}});var g=n.$class({constructor:function(){},render:function(){this.uiBind()},uiBind:function(){},kick:function(){},onKick:function(){},requirePassword:function(){},untrust:function(){},onUntrust:function(){},findDevice:function(){},deleteRecord:function(){},editPassword:function(){}});var u=n.$class({constructor:function(){this.$bindingContainer=$("[_role=bindingContainer]");this.$a11nContainer=$("[_role=a11nContainer]")},render:function(){this.uiBind()},uiBind:function(){this.$bindingContainer.delegate("[_role=icon]","click",n.proxy(function(I){this.onClickBindingIcon($(I.target))},this));this.$a11nContainer.delegate("[_role=icon]","click",n.proxy(function(I){this.onClickA11NIcon($(I.target))},this))},onClickBindingIcon:function(J){var I=J.attr("_name");Util.showPopup(I)},onClickA11NIcon:function(J){var I=J.attr("_name");Util.showPopup(I)}});var a=n.$class({constructor:function(){},render:function(){this.uiBind()},uiBind:function(){}});var c=n.$class({constructor:function(){},showPopup:function(I){$(I).show()},hidePopup:function(I){$(I).hide()},fix:function(I){if($.browser.msie&&+$.browser.version<=6){I.css({position:"absolute"});var J=$(document);$win.bind("scroll resize",y.debounce(n.proxy(function(){I.css({top:J.scrollTop()+"px",left:J.scrollLeft()+"px"})},this),500))}}});var A=n.$class({constructor:function(I){I=I||{};this.sgp=I.sgp;this.phoneTip=new F(".phone_tip");this.smsTip=new F(".sms_tip");this.regTip=new F(".reg_tip");this.usageTip=new F(".usage_tip");this.photoTip=new F(".photo_tip");this.idTip=new F(".id_tip");this.decoYearSelect("select.year");this.passwordItemGroup=new k({max:3,parent:$("#passwords"),selector:".add_more .labelbox",source:$("#passwords .add_more").html(),add:$("#passwords .add_more_link"),remove:$("#passwords .del_link")});this.emailItemGroup=new k({max:3,parent:$("#emails"),selector:".add_more .labelbox",source:$("#emails .add_more").html(),add:$("#emails .add_more_link"),remove:$("#emails .del_link")});this.phoneItemGroup=new k({max:3,parent:$("#phones"),selector:".add_more .labelbox",source:$("#phones .add_more").html(),add:$("#phones .add_more_link"),remove:$("#phones .del_link")});this.phoneModelItemGroup=new k({max:3,parent:$("#phone_models"),selector:".add_more .iselectbox",source:$("#phone_models .add_more"),add:$("#phone_models .add_more_link"),remove:$("#phone_models .del_link")});this.imeiItemGroup=new k({max:3,parent:$("#imeis"),selector:".add_more .labelbox",source:$("#imeis .add_more").html(),add:$("#imeis .add_more_link"),remove:$("#imeis .del_link")});this.eshopInfoItemGroup=new k({max:3,parent:$("#eshop-info-inputs-group"),selector:".add_more .labelbox",source:$("#eshop-info-inputs-group .add_more").html(),add:$("#eshop-info-inputs-group .add_more_link"),remove:$("#eshop-info-inputs-group .del_link")});this.loginAreaItemGroup=new k({max:3,parent:$(".login-location"),selector:".areapick_container .areapicker",source:$(".login-location .areapick_container").html(),add:$(".login-location .add_more_link"),remove:$(".login-location .del_link")})},quotaCache:{},captchHide:false,submitLock:0,isDecoSelect:false,uiBind:function(){$(".country-container-panel").each(function(T,U){var S=$("<div>").addClass("country-container");S.html(RegionsCode.getAll({usual:"常用"},true));$(U).append(S)});$(".listtit").click(function(S){S.stopPropagation();$(".country-container-panel").toggle()});$(document.body).click(function(S){!$(".country-container-panel").is(":hidden")&&$(".country-container-panel").hide();phoneCaptClicked=false});$(".country-container-panel .btn-cancel").bind("click",function(S){S.stopPropagation();$(this).closest(".country-container-panel").hide()});$(".country-container-panel").bind("click",function(S){S.stopPropagation()});$(".country-container").delegate(".record","click",function(X){X.stopPropagation();$(this).closest(".country-container-panel").hide();var Y=$(X.target).closest(".record");var U=Y.find(".record-country");var S=Y.find(".record-code");var W=$.trim(S.text()),T=$.trim(U.text()),V=U.data("code");$(".listtit").attr("_code",V).find("tt").html(T+"("+W+")&lrm;")});if(JSP_VAR.deviceType==="mobile"){var I=$(".navbar");I.length&&I.delegate("a","click",function(Y){var V=$(this);var T=V.closest(".country-container").find(".country-code");var S=T.scrollTop();var W=V.attr("to");var U=T.find(".countrycode-container-"+W);while(U.length===0){V=V.prev();U=T.find(".countrycode-container-"+V.attr("to"))}var X=U.offset().top;T.scrollTop(S+X);return false})}$(".chkcode_img").click(function(T){T.stopPropagation();var S=T.target,U=S.getAttribute("_src");S.src=U+"&"+(+new Date);phoneCaptClicked=true;$(this).parent().find("[name$='code']").val("")});sendTickPanel=$("#sendTicket");var L=$(".retrieve-panel,.retrieve-applyId");L.delegate("input[name]","focus",function(){s($(this))});L.delegate("input[name]","blur",function(){G($(this))});L.delegate(".i_selectbox","click",function(){s($(this).parent().find("select[name]"))});var R=$(".retrieve-addaply");R.delegate("input[name]","focus",function(){s($(this))});R.delegate("input[name]","blur",function(){G($(this),true)});$("#resend").click(n.proxy(function(S){if($(S.target).hasClass("noSend")){return}sendResetTicket(true)},this));$("#validate").click(n.proxy(function(X){var W=$(".listtit").attr("_code")||"";var S=$("#phone").val();var V=((W==="+86")?"":W)+S;var T=$.trim($(".resendcode").val());var U=$("#phone_models").find('select[name="mobilePhoneModel"]');if(!q(sendTickPanel)){return}$.ajax({url:"/pass/retrieve/verifyPhoneContactAddress",type:"POST",dataType:"text",data:{externalId:$("#externalId").val(),vkey:T,contactAddress:$.trim(V)},error:C,success:n.proxy(function(ac){ac=$.parseJSONSafe(ac.replace("&&&START&&&",""));if(ac.code===0){this.nextTabPanel();this.nextTabHeader();var aa=$.parseJSONSafe(ac.reason);if(!!aa.modelList){var ab=aa.modelList;var Z='<option value="-1">'+MSG.msgSelect+"</option>";for(var Y in ab){Z+='<option value="'+Y+'">'+ab[Y]+"</option>"}U.html(Z);if(!this.isDecoSelect){this.decoSelect(U,{search:true});this.isDecoSelect=true}}}else{switch(ac.code){case 70008:s($(".resendcode"),"phone_rule");break;case 20003:s($(".resendcode"),"notExist");break;case 70014:s($(".resendcode"),"vkey_rule");break;case 10001:case 5000000:s($(".resendcode"),"error_system",ac.code,true);break;default:}}},this)})},this));$("#phone_models").delegate(".search-code-input","input change propertychange",function(){var U=$.trim($(this).val());var S=$("#phone_models").find(".i_selectbox .i_selectoption");var T=S.find("dd");if(U.length){S.addClass("search-mode");T.each(function(V,X){var X=$(X);var Y=$(X).text();var W=new RegExp(U,"i");if(W.test(Y)){$(X).addClass("iselected")}else{$(X).removeClass("iselected")}})}else{S.removeClass("search-mode")}});$("#back_to_sms").click(n.proxy(function(S){S.preventDefault();if(this.smsTimer){this.smsTimer.stop()}var T=$("#resend").attr("_text");if(T){$("#resend").text(T)}setTimeout(n.proxy(function(){sendTickPanel.find(".error-con").hide();$(".resendcode").parent().removeClass("error_bg");this.changeToPanel("bind")},this),100)},this));var N=this.quotaCache;var Q=$("#submitPhone");Q.click(n.proxy(function(X){X.preventDefault();if(this.submitLock){return false}if(Q.hasClass("disabled")){return false}this.phoneTip.hide();this.smsTip.hide();$(".resendcode").parent().removeClass("error_bg");if(!q($("#bind"))){return false}var W=$(".listtit").attr("_code")||"";var S=$("#phone").val();var T=((W==="+86")?"":W)+S;var V=W?(W+" "+S):("+86 "+S);this.submitLock=1;if(N.hasOwnProperty(T)){var U=N[T];if(U===0){this.showLeftTimes(U,false,false)}else{this.checkNewPhoneBindStatus(T)}}else{this.checkQuota(T,n.proxy(function(Y){if(Y===0){this.showLeftTimes(Y,false,false)}else{this.checkNewPhoneBindStatus(T)}},this))}},this));var K=$(".retrieve-panel");var P=K.find(".bind-info-panel");P.find("a[data-action]").bind("click",n.proxy(function(X){X.stopPropagation();var W=$(X.target).data("action");if(W==="ok"){if(this.submitLock){return}this.submitLock=1;var V=$(".listtit").attr("_code")||"";var S=$("#phone").val();var T=((V==="+86")?"":V)+S;var U=V?(V+" "+S):("+86 "+S);this.checkNewRetrievePhone(true)}else{if(W==="back"){this.changeToPanel("bind")}}},this));var O=$("#devices");var J=$("#var_btn");J.click(n.proxy(function(S){var T=$(S.currentTarget);if(T.hasClass("disabled")){return}if(!q(O)){return false}this.nextTabPanel()},this));$("#usage_btn").click(n.proxy(function(T){if($(T.target).hasClass("disabled")){return false}T.preventDefault();this.usageTip.hide();this.regTip.hide();if(!q($("#history"))){return false}var S=this;$(this).trigger("panelSubmit")},this));$("#id_type").change(n.proxy(function(T){var S=+T.target.value;if(S){this.idTip.hide("empty_id_type")}},this));$("#final_btn").click(n.proxy(function(S){this.idTip.hide();if(!q($("#identity"))){return false}if(!$("#photoId").val()){s($("#img_area"),"photo_empty","",true);return}this.submit()},this));var M=this;window.uploadSuccess=function(){var V=window.frames&&window.frames.uploadIframe;if(!V||!V.data){return}var U=V.data;var T=U.tempId;var W=U.data;if(T!=$("#imgId").val()){return}clearTimeout(M.uploadTimeout);$("#timeout_mes").hide();$("#loading").hide();$("#photoId").val(W.mfsFileId);if(!W.success){switch(W.errorCode){case 20003:s($("#img_area"),"photo_notExist",W.errorCode,true);break;case 20005:s($("#img_area"),"photo_rule",W.errorCode,true);break;case 10012:case 10001:s($("#img_area"),"error_system",W.errorCode,true);break;case 80004:s($("#img_area"),"photo_res_large","",true);break;default:s($("#img_area"),"photo_fail","",true)}}else{s($("#img_area"));$("#img_area").attr("src","/pass/retrieve/photo/download?externalId="+encodeURIComponent($("#externalId").val())+"&mfsFileId="+W.mfsFileId+"&photoKey="+W.authkey);var S=$("#fileUpload");var X=S.attr("_retext");$("#fileButton").text(X)}};$("#img_area").bind("load error",function(S){$("#img_area").show()});$("#fileUpload").change(n.proxy(function(Z){var T=Z.target,W=T.form,X=T.value;if(X){var Y=X.lastIndexOf(".");if(Y!==-1){var U=X.substring(Y+1).toLowerCase();if(U!=="png"&&U!=="jpg"){s($("#img_area"),"photo_rule","",true);$("#img_area").hide();return}}var V=T.files;if(V&&V.length){var S=V[0];if(S.size>5<<20){s($("#img_area"),"photo_res_large","",true);$("#img_area").hide();return}}$("#imgId").val(+new Date);$(W).trigger("submit");$("#loading").show();$("#img_area").hide();$("#timeout_mes").hide();$("#error_mes").hide();this.uploadTimeout=setTimeout(n.proxy(function(){$("#loading").hide();$("#imgId").val(+new Date);$("#timeout_mes").show()},this),60000)}},this));$("#phone, #phone_capt").bind("keypress",function(S){if(S.keyCode===13){$("#submitPhone").click()}});$(".resendcode").bind("keypress",function(S){if(S.keyCode===13){$("#validate").click()}});$(document.body).delegate('input[name="mobilePhoneModel"], input[name="androidPhoneIMEI"]',"keypress",function(S){if(S.keyCode===13){$("#var_btn").click()}});$("#id_value").bind("keypress",function(S){if(S.keyCode===13){$("#final_btn").click()}});$("#YearLocation-dom").delegate(".i_currentselected","click",function(S){$("#registerType-dom .i_selectoption, #registerWay-dom .i_selectoption").hide()})},isPhoneNumber:function(I){if(/^\d{6,}$/.test(I)||/^\+\d{6,}$/.test(I)||/^0{2}\d{6,}$/.test(I)){return true}return false},showLeftTimes:function(K,M,L){var J=$("#appeal .shenhe_by_phone .too_much");var I=$("#quotaLabel");if(K>0){J.hide()}else{J.show();this.submitLock=0}if(K<=2){I.text(Math.max(0,K)).parent().show()}else{I.text(0).parent().hide()}},checkQuota:function(K,I){var J=this.quotaCache;$.ajax({data:{address:$.trim(K),contentType:4000004,externalId:$("#externalId").val()},type:"POST",url:"/pass/sms/manualQuota",dataType:"text",success:function(L){L=$.parseJSONSafe(L.replace("&&&START&&&",""));if(L.result===0){J[K]=parseInt(L.info);I&&I(parseInt(L.info))}else{I&&I(0)}},error:function(){I&&I(0)}})},checkNewPhoneBindStatus:function(K){var I=$(".shenhe_by_phone");var L=this.quotaCache[K];var J={externalId:$("#externalId").val(),contactAddress:$.trim(K),icode:$.trim($("#phone_capt").val())};if(this.captchHide===true){delete J.icode}$.ajax({url:"/pass/retrieve/checkManualUserBindInfo",type:"POST",dataType:"text",data:J,success:n.proxy(function(M){this.submitLock=0;M=$.parseJSONSafe(M.replace("&&&START&&&",""));if(M.code===0){var M=M.data;if(M.times===0){s(I.find('input[name="phone"]'),"bindLeftTimes")}else{if(M.hasAppealed){s(I.find('input[name="phone"]'),"existRetrieveApply")}else{if(M&&M.userId&&/\*+/.test(M.userId)){$(".bind-tip .bind-time").text(M.ts);$(".bind-tip .bind-id").text(M.userId);this.changeToPanel("bindTip")}else{this.checkNewRetrievePhone()}}}}else{if(M.code===87001){$(".chkcode_img").click();s(I.find('input[name="icode"]'),"icode_rule")}else{if(M.code===70008){s(I.find('input[name="phone"]'),"phone_rule")}else{if(M.code===20031){$(".shenhe_by_phone .inputcode").show();this.captchHide=false;$(".chkcode_img").click();s(I.find('input[name="icode"]'),"icode_empty")}else{if(M.code===70021){s(I.find('input[name="phone"]'),"phone_res_current")}else{s(I.find('input[name="icode"]'),"error_system",M.code,true)}}}}}},this)})},checkNewRetrievePhone:function(Q){var L=60000,I=60000;var O=this.quotaCache;var K=$(".shenhe_by_phone");var M=$("#prefix").attr("_code")||"";if(M==="+86"){M=""}var P=$("#phone").val();var J=M+P;var R;if(!M){R="+86 "+P}else{R=M+" "+P}var N=window.sendResetTicket=n.proxy(function(T){var S={externalId:$("#externalId").val(),contactAddress:$.trim(J)};$.ajax({type:"POST",dataType:"text",url:"/pass/retrieve/phoneContactAddressConfirmMessage",data:S,error:C,success:n.proxy(function(U){this.submitLock=0;U=$.parseJSONSafe(U.replace("&&&START&&&",""));this.phoneTip.hide();$("#phone").parent().removeClass("err_label");$("#phone_capt").parent().removeClass("err_label");switch(U.code){case 0:$(".shenhe_by_phone .inputcode").hide();this.captchHide=true;$("#full_phone").val(J);sendTickPanel.find(".address-place").text(R);var X=sendTickPanel.find("#resend"),W=X.attr("_text");X.addClass("noSend");var V=this.smsTimer=new y.Countdown({duration:I,onProgress:function(Y){X.text(W+"("+Math.round(Y.timeLeft/1000)+")")},onComplete:function(){X.text(W);if(O[J]>0){X.removeClass("noSend")}}});I+=L;V.start();$(".resendcode").val();O[J]--;if(!T){this.changeToPanel("sendTicket")}this.showLeftTimes(O[J],T,false);break;case 70021:s(K.find('input[name="phone"]'),"unqualCurrent");$(".chkcode_img").click();break;case 70013:s(K.find('input[name="phone"]'),"exist");$(".chkcode_img").click();break;case 20003:s(K.find('input[name="phone"]'),"notExist");$(".chkcode_img").click();break;case 20031:$(".shenhe_by_phone .inputcode").show();this.captchHide=false;s(K.find('input[name="icode"]'),"icode_empty");$(".chkcode_img").click();this.changeToPanel("bind");break;case 20023:s(K.find('input[name="phone"]'),"phoneBindTomuch");$(".chkcode_img").click();break;case 87001:$(".shenhe_by_phone .inputcode").show();this.captchHide=false;s(K.find('input[name="icode"]'),"icode_rule");$(".chkcode_img").click();this.changeToPanel("bind");break;case 70008:s(K.find('input[name="phone"]'),"phone_rule");$(".chkcode_img").click();break;case 70022:s(K.find('input[name="phone"]'),"sendFail");$(".chkcode_img").click();this.changeToPanel("bind");break;case 10001:case 5000000:s(K.find('input[name="icode"]'),"error_system",U.code,true);$(".chkcode_img").click();break;default:s(K.find('input[name="icode"]'),"error_system",U.code,true);$(".chkcode_img").click()}},this)})},this);N()},checkApplyID:function(){var L=$(".retrieve-applyId");var O=$(".retrieve-status-panel");var K=O.find(".retrieve-id");var J=O.find(".retrieve-status");var M=L.find('input[name="userKey"]');var N=L.find('input[name="icode"]');var I={userKey:$.trim(M.val()),icode:$.trim(N.val()),externalId:$("#externalId").val()};$.ajax({url:"/pass/retrieve/getApplicationStatus",type:"POST",dataType:"text",data:I,success:n.proxy(function(R){R=$.parseJSONSafe(R.replace("&&&START&&&",""));if(R.code===0){var Q=$.parseJSONSafe(R.reason);var P=Q.status;K.text(Q.userKey);if(P===0){J.text(MSG.status_todo);O.find(".status-tip-todo").show()}else{if(P===1){}else{if(P===2){J.text(MSG.status_refused);O.find(".status-tip-refused").show()}}}if(Q.times<=0){O.find(".add-apply").remove()}this.changeStepView(O)}else{if(R.code===87001){s(N,"icode_rule");$(".chkcode_img").click()}else{if(R.code===10017){s(M,"bad_param")}else{if(R.code===20501){s(M,"applyId_invalid")}else{s(N,"error_system",R.code,true)}}}}},this)})},initStep2:function(){var J=$("#retrieve-type .submit-to-next");var L=$("#retrieve-type .retrieve-type");var I=$("#retrieve-type .retrieve-type-value");var K=this.radioTab=$("#retrieve-type .md_way>li").bind("radioTabValueChange",function(O,N){if(N!==false){J.removeClass("disabled");L.val(N.retrieveType);I.val(N.retrieveTypeValue)}else{J.addClass("disabled");L.val("");I.val("")}}).radioTab();var M=this;J.click(function(){if(!J.hasClass("disabled")){if(L.val()===""||I.val()===""){s($(".retrieve-type-list li")[0],"retrieve_type_empty","",true);return false}M.nextTabPanel();M.nextTabHeader()}})},initStep3:function(){var J=$("#eshop-info");var I=J.find(".submit-to-next").addClass("disabled");I.bind("click",n.proxy(function(){if(!q(J)){return false}if(!I.hasClass("disabled")){this.nextTabPanel();this.nextTabHeader()}},this))},initStep4:function(){},initAll:function(){$(this).bind("panelSubmit",n.proxy(function(K,J){this.nextTabPanel();if(J){this.nextTabHeader()}},this));var I=this;$(".un_provide_area").bind("click",n.proxy(function(L){var K=$(L.target);if(K.hasClass("icon_select")){K=K.parent()}if(K.data("disable-click")===1){return false}K.toggleClass("now");var M=K.parents(".halfcon");var J=K.parents(".comfill_con");if(K.hasClass("now")){J.find(".labelbox").addClass("input_disabled").removeClass("err_label").find("input[name!='']").attr("disabled","disabled").val("");J.data("disable-add","1");K.closest(".area_container").find(".icon_add_del").addClass("cursor_d");I.usageTip.hide()}else{J.find(".labelbox").removeClass("input_disabled").find("input[name!='']").removeAttr("disabled");J.data("disable-add","0");K.closest(".area_container").find(".icon_add_del").removeClass("cursor_d")}s(J.find(".labelbox input"));this.syncUsage(M)},this));$(".panel-btn-back").bind("click",function(){I.prevTabPanel();if($(this).data("first-panel")){I.prevTabHeader()}});$(".halfcon").delegate(".labelbox input","input change",n.proxy(function(J){var K=$(J.target).parents(".halfcon");this.syncUsage(K)},this));$(".halfcon").delegate(".icon_add_del","click",n.proxy(function(J){var K=$(J.target).parents(".halfcon");this.syncUsage(K)},this));$(".othway").click(function(M){var L=$(this);var J=L.closest(".bd").find(".submit-to-next");$(M.currentTarget).toggleClass("now");var K=L.parents(".halfcon").find(".comfill_con");if(L.hasClass("now")){K.data("disable-add","1");K.find(".labelbox").addClass("input_disabled").find("input").attr("disabled","true").val("");K.find(".un_provide_area").removeClass("now").addClass("cursor_d").data("disable-click",1);K.find(".icon_add_del").addClass("cursor_d");K.find('input[name]:not(":hidden")').each(function(){s($(this))});J.removeClass("disabled")}else{K.data("disable-add","0");K.find(".labelbox").removeClass("input_disabled").find("input").removeAttr("disabled","true");K.find(".un_provide_area").removeClass("cursor_d").data("disable-click",0);K.find(".icon_add_del").removeClass("cursor_d");J.addClass("disabled")}})},initApplyStep1:function(){var J=$(".retrieve-applyId");var I=J.find(".submit-to-next");var K=J.find('input[name="icode"]');K.bind("keypress",function(L){if(L.keyCode===13){L.preventDefault();I.click()}});I.bind("click",n.proxy(function(){if(!q(J)){return false}this.checkApplyID()},this))},initApplyStep2:function(){var L=$(".retrieve-status-panel");var K=$(".retrieve-addaply");var J=L.find(".add-apply");var I=L.find(".retrieve-status");J.bind("click",n.proxy(function(){var M={externalId:$("#externalId").val(),userKey:L.find(".retrieve-id").text()};$.ajax({url:"updateApplication",type:"GET",dataType:"text",data:M,success:n.proxy(function(af){af=$.parseJSONSafe(af.replace("&&&START&&&",""));if(af.code===0){var S=$.parseJSONSafe(af.reason);if(S.status===1){J.hide();I.text(MSG.status_accetpt);L.find(".retrieve-status-tips>div").hide();L.find(".status-tip-accetpt").show()}else{var ac=S.applicationForm;var ab=K.find('select[name="mobilePhoneModel"]');this.changeStepView(K);if(!!S.modelList){var T=S.modelList;var U="";for(var Z in T){U+='<option value="'+Z+'">'+T[Z]+"</option>"}ab.append(U);this.decoSelect(ab)}for(var X in ac){var V=K.find('input[name="'+X+'"]');var R=K.find('select[name="'+X+'"]');var W=ac[X];var O="";if(X==="frequentlyLoginLocation"){R=K.find(".areapicker")}if(X==="photoIndex"){$(".download_img").attr("src","/pass/retrieve/photo/getPhoto?photoIndex="+W)}if(V.length){O=V.parent();var U=O.parent().html();if($.isArray(W)){for(var Z=1;Z<W.length;Z++){O.after(U)}var P=K.find('input[name="'+X+'"]');P.each(function(ag,ah){if(X!=="passwordUsed"){$(ah).val(W[ag])}})}else{V.val(W)}}if(R.length){if(X==="frequentlyLoginLocation"){O=R.parent();for(var Z=1;Z<W.length;Z++){var ad=$(this.loginAreaItemGroup.source);if(W[Z]){O.append(ad);selectArea(ad)}}var aa=K.find(".areapicker select[name]");var N=tarray=[];for(var Z=0;Z<W.length;Z++){var Q=W[Z];if(Q){tarray=Q.split("-");if(tarray.length===2){for(var Y=0;Y<2;Y++){tarray.push("")}}N.push.apply(N,tarray)}}aa.each(function(ag,ai){var ah=$(ai);var aj=N[ag];if(!!aj){ah.val(aj);if(ah.hasClass("country")||ah.hasClass("province")){ah.trigger("change")}ah.parent().find(".i_currentselected").text(aj)}})}else{O=R.parent().parent();if($.isArray(W)){for(var Z=1;Z<W.length;Z++){var ad=$('<div class="iselectbox"/>').html(R.prop("outerHTML"));O.append(ad);var ae=ad.find("select");this.decoSelect(ae)}var aa=K.find('select[name="'+X+'"]');aa.each(function(ah,ai){var ag=R.find("option[value="+W[ah]+"]").text();$(ai).val(W[ah]);$(ai).closest(".iselectbox").find(".i_currentselected").text(ag)})}else{var Q=R.find("option[value="+W+"]").text();R.val(W);R.closest(".iselectbox").find(".i_currentselected").text(Q)}}}}}}else{if(af.code===20501){s(I,"applyId_invalid","",true)}else{s(I,"error_system",af.code,true)}}},this)})},this))},initApplyStep3:function(){var J=$(".retrieve-addaply");var I=J.find(".submit-to-next");I.bind("click",n.proxy(function(){if(!q(J,true)){return false}this.applySubmit()},this))},render:function(){$.placehold.removepld();$.placehold.init();this.uiBind();this.initAll();this.initStep2();this.initStep3();this.initStep4();this.initApplyStep1();this.initApplyStep2();this.initApplyStep3();this.toFirstHeader();this.toFirstPanel();var I=$("#resend");I.attr("_text",I.text());this.decoSelect("select[_decorable]");$(".login-location .areapicker").each(function(K,L){var J=$(L);selectArea(J)});$(".chkcode_img").click();this.passwordItemGroup.render();this.emailItemGroup.render();this.phoneItemGroup.render();this.phoneModelItemGroup.render();this.imeiItemGroup.render();this.eshopInfoItemGroup.render();this.loginAreaItemGroup.render();if(this.sgp){$(".othway").hide()}$("#uploadImgForm").appendTo("#nested").show();$("#YearLocation-dom .i_selectoption > dd:first-child").hide()},toFirstHeader:function(){var J=$(".tab_opt > span");var I=0;$(J.removeClass("now")[I]).addClass("now");var K=$(".tabline > i");$(K.removeClass("now")[I]).addClass("now");window.scrollTo(0,0)},syncUsage:function(M){var L=this;var K=M.find('.input_kuang[name!=""]');var J=M.find('.input_kuang[name!=""][value=]:not(":disabled")');var I=M.closest(".bd").find(".btn_commom");if(!J.length){I.removeClass("disabled")}else{I.addClass("disabled")}},toFirstPanel:function(){var K=$("#appeal .bd");var J=$(".retrieve-view");var I=0;$(K.hide()[I]).show();$(J[I]).show();window.scrollTo(0,0)},nextnextTabHeader:function(){var J=$(".tab_opt > span");var I=J.filter(".now").index("span");$(J.removeClass("now")[I+2]).addClass("now");var K=$(".tabline > i");$(K.removeClass("now")[I+2]).addClass("now");window.scrollTo(0,0)},nextTabHeader:function(){var J=$(".tab_opt > span");var I=J.filter(".now").index("span");$(J.removeClass("now")[I+1]).addClass("now");var K=$(".tabline > i");$(K.removeClass("now")[I+1]).addClass("now");window.scrollTo(0,0)},prevprevTabHeader:function(){var J=$(".tab_opt > span");var I=J.filter(".now").index("span");$(J.removeClass("now")[I-2]).addClass("now");var K=$(".tabline > i");$(K.removeClass("now")[I-2]).addClass("now");window.scrollTo(0,0)},prevTabHeader:function(){var J=$(".tab_opt > span");var I=J.filter(".now").index("span");$(J.removeClass("now")[I-1]).addClass("now");var K=$(".tabline > i");$(K.removeClass("now")[I-1]).addClass("now");window.scrollTo(0,0)},nextnextTabPanel:function(){var J=$("#appeal .bd");var I=J.filter(":visible").index(".bd");$(J.hide()[I+2]).show();window.scrollTo(0,0)},nextTabPanel:function(K){var J=$("#appeal .bd");var I=J.filter(":visible").index(".bd");if(K){$(J.hide()[I+K]).show()}else{$(J.hide()[I+1]).show()}window.scrollTo(0,0)},prevTabPanel:function(K){var J=$("#appeal .bd");var I=J.filter(":visible").index(".bd");if(K){$(J.hide()[I-K]).show()}else{$(J.hide()[I-1]).show()}window.scrollTo(0,0)},changeToPanel:function(J){var I=$("#appeal .bd");var K=I.filter(":visible").attr("id");if(J!==K){I.hide();$("#"+J).show();window.scrollTo(0,0)}},changeStepView:function(J){var I=$(".retrieve-view");I.hide();J.show()},prevprevTabPanel:function(){var J=$("#appeal .bd");var I=J.filter(":visible").index(".bd");$(J.hide()[I-2]).show();window.scrollTo(0,0)},decoSelect:function(I,K){var J=$(I);J.iSimulateSelect(K);$(".i_currentselected, i_selectoption, .i_selectoption").css("width","100%");$(".i_selectoption > dd:first-child").hide()},appendSelect:function(I,J){$(J).append(decoSelect(I))},prependSelect:function(I,J){$(J).prepend(decoSelect(I))},decoYearSelect:function(I){$(I).each(function(K,M){var J=M.options;J.length=1;var L=new Date().getFullYear();for(var O=L;O>=2012;O--){var N=$('<option value="'+O+'">'+O+"</option>").appendTo(M)}})},getLocationValues:function(){var I=$(".login-location");var J=I.find(".areapicker");I.find('input[name="frequentlyLoginLocation"]').remove();J.each(function(O,W){var S=$('<input type="hidden" name="frequentlyLoginLocation" />');var U=$(W);var P=U.find(".year"),R=U.find(".country"),V=U.find(".province"),M=U.find(".city");var Q=P.val(),L=R.val();var K=V.val();var N=M.val();var T="";if(Q&&L){if(K===MSG.other||parseInt(N)===0){T=[Q,L].join("-")}else{T=[Q,L,K,N].join("-")}I.append(S.val(T))}})},filterInputSpace:function(I){I.each(function(){var K=$(this);var L=K.attr("name");var J=$.trim(K.val());if($.inArray(L,r)===-1&&!K.is(":disabled")&&K.attr("type")!=="file"){K.val(J)}})},submit:function(){$('#devices [name="androidPhoneIMEI"], #devices [name="iphoneWIFI"]').each(function(I,J){var K=$.trim(J.value);if(!K){$(J).remove()}});this.getLocationValues();this.filterInputSpace($('.retrieve-panel input[name][type!="hidden"]'));$("#appeal").trigger("submit")},applySubmit:function(){this.getLocationValues();this.filterInputSpace($('#retrieve-applay input[name][type!="hidden"]'));$("#retrieve-applay").trigger("submit")}});var k=n.$class({constructor:function(I){this.$parent=$(I.parent||I.$parent);this.selector=I.selector;this.source=I.source;this.$add=$(I.add||I.$add);this.$remove=$(I.remove||I.$remove);this.min="min" in I?I.min:1;this.max="max" in I?I.max:Number.MAX_VALUE},items:function(){return this.$parent.find(this.selector)},size:function(){return this.items().length},uiBind:function(){this.$add.click(n.proxy(function(I){I.preventDefault();this.add()},this));this.$remove.click(n.proxy(function(I){I.preventDefault();this.remove()},this))},add:function(){var I=this.items(),K=I.length;var N=this.$parent.find(".un_provide_area");if(this.$parent.data("disable-add")==="1"){return}if(K<this.max){var M=$(this.source);if(M.find('select[name="mobilePhoneModel"]').length){M=$('<div class="iselectbox"></div>').html(M.find('select[name="mobilePhoneModel"]').prop("outerHTML"))}var L=$(I[K-1]);if(L.length){L.after(M)}else{this.$parent.append(M)}var J=M.find("select[name]");if(J.length){if($(J[0]).parent().hasClass("areapicker_item")){selectArea(M)}else{if(this.$parent.hasClass("phone-models")){J.iSimulateSelect({search:true})}else{J.iSimulateSelect()}}M.find(".i_selectoption > dd:first-child").hide()}}this.$remove.show();N.hide();if(K+1>=this.max){this.$add.hide()}},remove:function(){var I=this.items(),J=I.length;var K=this.$parent.find(".un_provide_area");if(this.$parent.data("disable-add")==="1"){return}s($(I[J-1]).find("input[name]"));s($(I[J-1]).find("select[name]"));if(J>this.min){$(I[J-1]).remove()}this.$add.show();if(J-1<=this.min){this.$remove.hide();K.show()}},render:function(){this.uiBind();var I=this.size();if(I<=this.min){this.$remove.hide()}else{this.$remove.show()}if(I>=this.max){this.$add.hide()}else{this.$add.show()}}});var t=n.$class({constructor:function(I){I=I||{};this.$idBox=$("#externalId");this.$form=this.$idBox.closest("FORM");this.idTip=new F(".id_tip")},render:function(){this.uiBind()},uiBind:function(){this.$idBox.bind("click focus",n.proxy(function(I){this.idTip.hide();this.$idBox.parent().removeClass("err_label")},this));this.$form.submit(n.proxy(function(J){var K=$.trim(this.$idBox.val());if(!K){this.idTip.show("empty_id");this.$idBox.parent().addClass("err_label");return false}var I=new RegExp(this.$idBox.attr("rule"));if(!I.test(K)){this.idTip.show("wng_fmt");this.$idBox.parent().addClass("err_label");return false}K=K.replace(/^\+86/,"");this.$idBox.val(K)},this))}});return{Security:j,Profile:B,LoginManager:g,BindingA11N:u,Services:a,Utils:c,AppealForm:A,PreappealForm:t}});